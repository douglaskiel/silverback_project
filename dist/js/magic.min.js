/*
 initialserver 2017-06-13 
*/

<<<<<<< HEAD
!function(e,a,n){a.module("app",["ui.router","ngSanitize","angular.filter"]).config(["$urlRouterProvider","$stateProvider",function(e,a){a.state("index",{templateUrl:"/src/index.html",controller:"indexCtrl"}).state("home",{url:"/",templateUrl:"/src/components/home/home.html",controller:"homeCtrl"}).state("login",{url:"/login",templateUrl:"/src/components/user/views/login.html",controller:"loginCtrl"}).state("password_recovery",{url:"/password_recovery",templateUrl:"/src/components/user/views/password_recovery.html",controller:"loginCtrl"}).state("reset_password",{url:"/reset_password/:userID/:resetCode",templateUrl:"/src/components/user/views/reset_password.html",controller:"pswdCtrl"}).state("register",{url:"/register",templateUrl:"/src/components/user/views/register.html",controller:"registerCtrl"}).state("manage_users",{url:"/manage_users",templateUrl:"src/components/user/views/manage_users.html",controller:"manageUserCtrl"}).state("profile",{url:"/profile:user",templateUrl:"/src/components/user/views/profile.html",controller:"profileCtrl"}).state("company",{url:"/company",templateUrl:"/src/components/company/company.html",controller:"companyCtrl"}).state("invoice_configuration",{url:"/invoice_configuration",templateUrl:"/src/components/invoice_configuration/invoice_config.html"}).state("iot",{url:"/invoice_configuration/iot",templateUrl:"/src/components/invoice_configuration/IOT/iot.html",controller:"iotCtrl"}).state("fuel_rates",{url:"/invoice_configuration/fuel_rates",templateUrl:"/src/components/invoice_configuration/fuel_rates/fuel_rates.html",controller:"fuelRatesCtrl"}).state("operational_area",{url:"/invoice_configuration/operational_area",templateUrl:"/src/components/invoice_configuration/operational_area/operational_area.html",controller:"operationalAreaCtrl"}).state("carriers",{url:"/invoice_configuration/carriers",templateUrl:"/src/components/invoice_configuration/carriers/carriers.html",controller:"carrierCtrl"}).state("accessorial_cost",{url:"/invoice_configuration/accessorial_cost",templateUrl:"/src/components/invoice_configuration/prebuilt_associated_costs/prebuilt_associated_costs.html",controller:"accessorialCtrl"}).state("fsc",{url:"/invoice_configuration/fsc",templateUrl:"/src/components/invoice_configuration/fuel_surcharge_rates/fuel_surcharge_rates.html",controller:"fscCtrl"}).state("benchmark_fsc",{url:"/invoice_configuration/benchmark_fsc",templateUrl:"/src/components/invoice_configuration/benchmark_fsc/benchmark_fsc.html",controller:"benchmarkFSCCtrl"}).state("state_region",{url:"/invoice_configuration/state_region",templateUrl:"src/components/invoice_configuration/state_regions/state_regions.html",controller:"stateRegionCtrl"}).state("edi-parsing",{url:"/invoice/",templateUrl:"/srccomponents/invoice/views/edi-parsing.html",controller:"ediCtrl"}).state("list-invoice",{url:"/invoice",templateUrl:"/src/components/invoice/views/list-invoice.html",controller:"invoiceListCtrl"}).state("form-invoice",{url:"/invoice/form-invoice/:invoiceID",templateUrl:"/src/components/invoice/views/form-invoice.html",controller:"invoiceFormCtrl"}).state("view-invoice",{url:"/invoice/view-invoice/:invoiceID",templateUrl:"/src/components/invoice/views/view-invoice.html",controller:"invoiceViewCtrl"}).state("price-savings",{url:"/invoice/price-savings/:invoiceIDs/:xpoIDs",templateUrl:"/src/components/invoice/views/price-savings.html",controller:"priceSavingsCtrl"}).state("view-xpo-invoice",{url:"/invoice/view-xpo-invoice/:invoiceID",templateUrl:"/src/components/invoice/views/view-xpo-invoice.html",controller:"viewXPOInvoice"}).state("form-xpo-invoice",{url:"/invoice/form-xpo-invoice/:xpoID",templateUrl:"/src/components/invoice/views/form-invoice.html",controller:"invoiceFormCtrl"}),e.otherwise("/")}])}(window,window.angular),function(e,a,n){a.module("app").controller("companyCtrl",["$scope","$state","$http","userSvc","clientSvc",function(e,a,n,r,t){var s={headers:{"auth-token":r.token}};e.allCompanies=[],e.getClients=function(a){t.getClients(a).then(function(a){e.allCompanies=a})},e.getClients(s),e.submitCompany=function(e){e.hasOwnProperty("client_address_2")?e.client_address_2=cleanEntry(e.client_address_2):e.client_address_2="",e.hasOwnProperty("client_zip_4")||(e.client_zip_4=""),e.client_address_1=cleanEntry(e.client_address_1),e.client_city=cleanEntry(e.client_city),e.client_country=cleanEntry(e.client_country),e.client_name=cleanEntry(e.client_name),e.client_id?t.updateClients(e,s):t.sumbitClients(e,s)},e.deleteCompany=function(a){if(!0===confirm("Are you sure you want to delete this Client?")){request="/secure-api/company/company_delete/?"+a,t.deleteClients(request,s);for(var n in e.allCompanies)e.allCompanies[n].client_id===a&&e.allCompanies.splice(n,1)}}}])}(window,window.angular),function(e,a,n){a.module("app").controller("homeCtrl",["$scope","$state","$http","userSvc",function(e,a,n,r){e.allCompanies=[];r.token}])}(window,window.angular),function(e,a,n){a.module("app").controller("indexCtrl",["$scope","$state","$http","userSvc",function(e,a,n,r){e.approvedUser=function(){return"Editor"===r.role||"Admin"===r.role?(e.approved=!0,!0):(e.approved=!1,!1)},e.isLoggedin=function(){return!!r.token&&(e.username=r.user,!0)},e.isAdmin=function(){return"Admin"===r.role},e.logoutConfirm=function(){!0===confirm("Are you sure you want to log out?")&&e.logout()},e.logout=function(){r.token=null,r.user=null,r.role=null,e.username=null,localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("role"),a.go("login")}}])}(window,window.angular),function(e,a,n){a.module("app").controller("invoiceFormCtrl",["$scope","$state","$http","$stateParams","userSvc","accessSvc","carrierSvc","operationAreaSvc","fuelRateService","iotSvc","clientSvc",function(e,n,r,t,s,i,o,c,l,u,p){var d={headers:{"auth-token":s.token}};if(e.allInvoices=[],e.specificInvoice=[],e.allCompanies=[],e.incomingEdi=[],e.allFuelRates=[],e.allIOT=[],e.items=[],e.totalWeight=0,e.totalAccessorialCharges=0,e.invoice={},e.classOptions=[50,55,60,65,70,77.5,85,92.5,100,110,125,150,175,200,250,300,400,500],e.shippingClasses=[],e.accessorialCharges=[],e.totalBenchmarkCost=[],e.allOperations=[],e.rateString="",e.returnString="",e.state=n.current,e.params=t,e.errors=!1,e.errorsArry=[],e.newRow=!1,e.allAccessorialBenchmark=[],e.allCarriers=[],e.getEverything=function(a){i.getAccess(a).then(function(a){e.allAccessorialBenchmark=a}),o.getCarriers(a).then(function(a){e.allCarriers=a}),c.getOperationalArea(a).then(function(a){e.allOperations=a}),l.getFuelRate(a).then(function(a){e.allFuelRates=a}),u.getIOT(a).then(function(a){e.allIOT=a}),p.getClients(a).then(function(a){e.allCompanies=a})},e.getEverything(d),e.params.invoiceID)r.get("/secure-api/invoice/get_invoice?"+e.params.invoiceID,d).then(function(a){e.specificInvoice=a.data.data;for(var n=0;n<e.specificInvoice.length;n++)e.specificInvoice[n].process_date=date_parse(e.specificInvoice[n].process_date),e.specificInvoice[n].ship_date=date_parse(e.specificInvoice[n].ship_date),e.specificInvoice[n].delivery_date=date_parse(e.specificInvoice[n].delivery_date),e.specificInvoice[n].billed_weight=parseFloat(e.specificInvoice[n].billed_weight),e.specificInvoice[n].total_associated_costs=parseFloat(e.specificInvoice[n].total_associated_costs),e.specificInvoice[n].classification=parseFloat(e.specificInvoice[n].classification),e.specificInvoice[n].weight=parseFloat(e.specificInvoice[n].weight),e.specificInvoice[n].gross_charge=parseFloat(e.specificInvoice[n].gross_charge),e.specificInvoice[n].absolute_min_charge=parseFloat(e.specificInvoice[n].absolute_min_charge),e.specificInvoice[n].carrier_discount=parseFloat(e.specificInvoice[n].carrier_discount),e.shippingClasses.push({weight:e.specificInvoice[n].weight,classification:e.specificInvoice[n].classification,rate:e.specificInvoice[n].rate,charge:e.specificInvoice[n].charge,invoice_number:e.specificInvoice[n].invoice_number,item_id:e.specificInvoice[n].item_id}),e.PD={},e.specificInvoice[n].carrier_name=undoCleanEntry(e.specificInvoice[n].carrier_name),e.specificInvoice[n].invoice_number=undoCleanEntry(e.specificInvoice[n].invoice_number),e.specificInvoice[n].sender_name=undoCleanEntry(e.specificInvoice[n].sender_name),e.specificInvoice[n].sender_address_1=undoCleanEntry(e.specificInvoice[n].sender_address_1),e.specificInvoice[n].sender_city=undoCleanEntry(e.specificInvoice[n].sender_city),e.specificInvoice[n].sender_country=undoCleanEntry(e.specificInvoice[n].sender_country),e.specificInvoice[n].receiver_name=undoCleanEntry(e.specificInvoice[n].receiver_name),e.specificInvoice[n].receiver_address_1=undoCleanEntry(e.specificInvoice[n].receiver_address_1),e.specificInvoice[n].receiver_city=undoCleanEntry(e.specificInvoice[n].receiver_city),e.specificInvoice[n].receiver_country=undoCleanEntry(e.specificInvoice[n].receiver_country),e.specificInvoice[n].transportation_mode=undoCleanEntry(e.specificInvoice[n].transportation_mode),e.specificInvoice[n].package_type=undoCleanEntry(e.specificInvoice[n].package_type),e.specificInvoice[n].receiver_zip_4=undoCleanEntry(e.specificInvoice[n].receiver_zip_4),e.specificInvoice[n].receiver_zip=undoCleanEntry(e.specificInvoice[n].receiver_zip),e.specificInvoice[n].sender_zip=undoCleanEntry(e.specificInvoice[n].sender_zip),e.specificInvoice[n].sender_zip_4=undoCleanEntry(e.specificInvoice[n].sender_zip_4),e.specificInvoice[n].deficit=parseFloat(e.specificInvoice[n].deficit),e.specificInvoice[n].deficit_rate=parseFloat(e.specificInvoice[n].deficit_rate);e.invoice=e.specificInvoice[0],e.items=e.specificInvoice,r.get("/secure-api/accessorial_cost_invoice/get_associated_costs_invoice?"+e.specificInvoice[0].invoice_number,d).then(function(a){e.associatedCosts=a.data.data;for(var n=0;n<e.associatedCosts.length;n++)e.accessorialCharges.push({actual_cost:parseFloat(e.associatedCosts[n].actual_cost),benchmark_cost:parseFloat(e.associatedCosts[n].benchmark_cost),cost_code:e.associatedCosts[n].cost_code,cost_id:e.associatedCosts[n].cost_id,invoice_number:e.associatedCosts[n].invoice_number}),e.PD={}},function(e){console.log(e)})},function(e){console.log(e),n.go("login")});else if(e.params.xpoID)r.get("/secure-api/xpo/get_xpo_invoice?"+e.params.xpoID,d).then(function(a){e.xpoInvoice=a.data.data,e.xpoInvoice[0].old_cost=Math.round(100*parseFloat(e.xpoInvoice[0].old_cost))/100,e.xpoInvoice[0].old_fsc=Math.round(100*parseFloat(e.xpoInvoice[0].old_fsc))/100,e.xpoInvoice[0].old_total_cost=Math.round(100*parseFloat(e.xpoInvoice[0].old_total_cost))/100,e.xpoInvoice[0].new_cost=Math.round(100*parseFloat(e.xpoInvoice[0].new_cost))/100,e.xpoInvoice[0].new_fsc=Math.round(100*parseFloat(e.xpoInvoice[0].new_fsc))/100,e.xpoInvoice[0].new_total_cost=Math.round(100*parseFloat(e.xpoInvoice[0].new_total_cost))/100,e.xpoInvoice[0].discount_percent=sanatizePercent(e.xpoInvoice[0].discount_percent),e.xpoInvoice[0].savings=Math.round(100*parseFloat(e.xpoInvoice[0].savings))/100,e.xpoInvoice[0].base_charge=Math.round(100*parseFloat(e.xpoInvoice[0].base_charge))/100,e.xpoInvoice[0].ship_date=date_parse(e.xpoInvoice[0].ship_date),e.xpoInvoice[0].process_date=date_parse(e.xpoInvoice[0].process_date),e.xpoInvoice[0].discount_ammount=Math.round(100*parseFloat(e.xpoInvoice[0].discount_ammount))/100,console.log(e.xpoInvoice[0]),e.invoice=e.xpoInvoice[0]},function(e){console.log(e),n.go("login")});else{e.invoice={};var v=new Date,_=v.getDay();e.invoice.process_date=5===_?v:new Date(moment().day(5)),e.shippingClasses.push({}),e.PD={}}e.setOldCost=function(a){e.invoice.old_cost=a*(1-.829),e.invoice.discount_percent=sanatizePercent(e.invoice.discount_ammount/a),e.invoice.new_cost=a*(1-sanatizePercent(e.invoice.discount_percent)),e.invoice.old_fsc=e.invoice.old_cost*sanatizePercent(e.invoice.fsc_percent),e.invoice.new_fsc=e.invoice.new_cost*sanatizePercent(e.invoice.fsc_percent),e.invoice.old_total_cost=e.invoice.old_cost+e.invoice.old_fsc,e.invoice.new_total_cost=e.invoice.new_cost+e.invoice.new_fsc,e.invoice.savings=e.invoice.old_total_cost-e.invoice.new_total_cost},e.submitXPOInvoice=function(a){a.old_cost=Math.round(100*parseFloat(a.old_cost))/100,a.old_fsc=Math.round(100*parseFloat(a.old_fsc))/100,a.old_total_cost=Math.round(100*parseFloat(a.old_total_cost))/100,a.new_cost=Math.round(100*parseFloat(a.new_cost))/100,a.new_fsc=Math.round(100*parseFloat(a.new_fsc))/100,a.new_total_cost=Math.round(100*parseFloat(a.new_total_cost))/100,a.discount_percent=sanatizePercent(a.discount_percent),a.savings=Math.round(100*parseFloat(a.savings))/100,a.discount_ammount=Math.round(100*parseFloat(a.discount_ammount))/100,console.log(a);for(var t in e.allCompanies)e.allCompanies[t].client_id===a.client_id&&(a.client_name=e.allCompanies[t].client_name);a.accelerated_charge||(a.accelerated_charge=0),e.params.xpoID?r.put("/secure-api/xpo/update_xpo_invoice",a,d).then(function(e){console.log("Invoice Updated"),n.reload()},function(e){console.log(e)}):r.post("/secure-api/xpo/insert_xpo_invoice",a,d).then(function(e){console.log("New Invoice Added"),n.reload()},function(e){console.error(e)})},e.carrierCheck=function(){var a,n,r=e.invoice.sender_state,t=e.invoice.receiver_state,s=e.invoice.sender_zip,i=e.invoice.receiver_zip,o=e.invoice.carrier_id;for(var c in e.allCarriers)e.invoice.carrier_id===e.allCarriers[c].carrier_id&&(e.invoice.carrier_name=e.allCarriers[c].carrier_name);if(o&&r&&t){for(c in e.allOperations)if(e.allOperations[c].carrier_id===o&&e.allOperations[c].states===r){if(!e.allOperations[c].zip_code||""===e.allOperations[c].zip_code){a=e.allOperations[c];break}if(e.allOperations[c].zip_code===s){a=e.allOperations[c];break}}for(c in e.allOperations)if(e.allOperations[c].carrier_id===o&&e.allOperations[c].states===t){if(e.allOperations[c].zip_code===i){n=e.allOperations[c];break}if(!e.allOperations[c].zip_code||""===e.allOperations[c].zip_code){n=e.allOperations[c];break}}var l;l="IN"===a.states||"IN"===n.states?parseFloat(a.absolute_minimum_charge)>parseFloat(n.absolute_minimum_charge):parseFloat(a.absolute_minimum_charge)<parseFloat(n.absolute_minimum_charge),a&&n&&(l?(e.invoice.absolute_min_charge=parseFloat(a.absolute_minimum_charge),e.invoice.carrier_discount=parseFloat(a.discount),e.invoice.accelerated_charge=parseFloat(a.accelerated_charge)):(e.invoice.absolute_min_charge=parseFloat(n.absolute_minimum_charge),e.invoice.carrier_discount=parseFloat(n.discount),e.invoice.accelerated_charge=parseFloat(n.accelerated_charge)))}},e.submitInvoice=function(a,t,s){e.errors=!1,e.errorsArry=[];var i=!1,o=!1,c=!1,l=!1;for(var u in e.allOperations)if(e.allOperations[u].states===a.sender_state&&e.allOperations[u].carrier_id===a.carrier_id&&(i=!0),e.allOperations[u].states===a.receiver_state&&e.allOperations[u].carrier_id===a.carrier_id&&(o=!0),(e.allOperations[u].zip_code==a.sender_zip&&e.allOperations[u].carrier_id===a.carrier_id||(null===e.allOperations[u].zip_code||""===e.allOperations[u].zip_code)&&e.allOperations[u].carrier_id===a.carrier_id)&&(c=!0),(e.allOperations[u].zip_code==a.receiver_zip&&e.allOperations[u].carrier_id===a.carrier_id||(null===e.allOperations[u].zip_code||""===e.allOperations[u].zip_code)&&e.allOperations[u].carrier_id===a.carrier_id)&&(l=!0),i&&o&&c&&l)break;var p=!0;if(a.accelerated_charge||(a.accelerated_charge=0),i&&o&&c&&l||(p=confirm("The carrier you selected does not appear to deleive to the selected State and Zip Code combination, would you like to continue anyway?")),p)if(e.totalWeight=0,e.totalAccessorialCharges=0,e.totalBenchmarkCost=0,t!=[]&&0!==t.length){a.hasOwnProperty("sender_zip_4")||(a.sender_zip_4=""),a.hasOwnProperty("receiver_zip_4")||(a.receiver_zip_4=""),a.invoice_number=cleanEntry(a.invoice_number),a.sender_name=cleanEntry(a.sender_name),a.sender_address_1=cleanEntry(a.sender_address_1),a.sender_city=cleanEntry(a.sender_city),a.sender_country=cleanEntry(a.sender_country),a.receiver_name=cleanEntry(a.receiver_name),a.receiver_address_1=cleanEntry(a.receiver_address_1),a.receiver_city=cleanEntry(a.receiver_city),a.receiver_country=cleanEntry(a.receiver_country),a.transportation_mode=cleanEntry(a.transportation_mode),a.package_type=cleanEntry(a.package_type),a.receiver_zip_4=cleanEntry(a.receiver_zip_4),a.receiver_zip=cleanEntry(a.receiver_zip),a.sender_zip=cleanEntry(a.sender_zip),a.sender_zip_4=cleanEntry(a.sender_zip_4),a.carrier_discount=Math.round(100*sanatizePercent(a.carrier_discount))/100,a.accelerated_service||(a.accelerated_service=!1);for(u in t)t[u].invoice_number=a.invoice_number,e.totalWeight+=parseFloat(t[u].weight);a.billed_weight=e.totalWeight;for(u in s)s[u].invoice_number=a.invoice_number,e.totalAccessorialCharges+=parseFloat(s[u].actual_cost),e.totalBenchmarkCost+=s[u].benchmark_cost;s||(s=[]),a.total_associated_costs=e.totalAccessorialCharges,a.total_benchmark=e.totalBenchmarkCost,e.rateShipment(a,function(){""===e.params.invoiceID?r.post("/secure-api/invoice/insert_invoice",{invoice:a,shippedItems:t,accessorialCharges:s},d).then(function(e){console.log("New Invoice Added"),n.reload()},function(a){console.error(a);for(var n in a.data.errors)e.errors=!0,console.log(a.data.errors[n].message),e.errorsArry.push(a.data.errors[n].message)}):r.put("/secure-api/invoice/update_invoice",{invoice:a,shippedItems:t,accessorialCharges:s},d).then(function(e){console.log("Invoice Updated"),n.reload()},function(a){e.errors=!0,console.log(a);for(var n in a.data.errors)console.log(a.data.errors[n].message),e.errorsArry.push(a.data.errors[n].message)})})}else console.log("You must have atleast one item to submit this Invoice")},e.rateShipment=function(a,n){for(var t=a.sender_zip+" "+a.receiver_zip+" ",s=1e4*a.carrier_discount,i=0;i<10;i++)t+=s;a.absolute_min_charge<100?t=t+"0"+100*a.absolute_min_charge:t+=100*a.absolute_min_charge;var o=(Math.round(1e4*a.fuel_surcharge)/100).toString();for(t=t+(o=padding_right(o," ",6))+o,t+="      ",i=0;i<10;i++)if(e.shippingClasses[i]){var c=e.shippingClasses[i].classification.toString();c.length<4&&(c=padding_right(c," ",4));var l=e.shippingClasses[i].weight.toString();l.length<6&&(l=padding_left(l,"0",6)),t+=c,t+=padding_right(l," ",19)}t=padding_right(t," ",405),t+="MARS 500       20010806";var u={rateString:t=padding_right(t," ",500)};r.put("/secure-api/invoice/test_tcp",u,d).then(function(r){var t=r.data;for(e.returnString=t.replace(/ /g,"&nbsp;"),i=0;i<10;i++){var s=85,o=91,c=91,l=98,u=23*i;e.shippingClasses[i]&&(s+=u,o+=u,c+=u,l+=u,rate=t.slice(s,o),rate=[rate.slice(0,-2),".",rate.slice(-2)].join(""),e.shippingClasses[i].rate=parseFloat(rate),charge=t.slice(c,l),charge=[charge.slice(0,-2),".",charge.slice(-2)].join(""),e.shippingClasses[i].charge=parseFloat(charge))}var p=t.slice(318,326);p=[p.slice(0,-2),".",p.slice(-2)].join(""),e.invoice.rated_sum=parseFloat(p),e.invoice.deficit_rate=parseFloat(t.slice(342,349))/100;var d=t.slice(396,404);d=[d.slice(0,-2),".",d.slice(-2)].join(""),e.invoice.rated_total_charge=parseFloat(d),n(a)},function(a){switch(console.log(a),e.errors=!0,a.data){case"01":console.log("This tariff is not available"),e.errorsArry.push("MARS Error 01: This tariff is not available");break;case"02":console.log("Rates are not available for this date"),e.errorsArry.push("MARS Error 02: Rates are not available for this date");break;case"03":console.log("The origin ZIP Code was not found in this tariff"),e.errorsArry.push("MARS Error 03: The origin ZIP Code was not found in this tariff");break;case"04":console.log("The destination ZIP Code was not found in this tariff"),e.errorsArry.push("MARS Error 04: The destination ZIP Code was not found in this tariff");break;case"05":console.log("A rate base number was not found for this pair of ZIP Codes"),e.errorsArry.push("MARS Error 05: A rate base number was not found for this pair of ZIP Codes");break;case"06":console.log("Tariff data is missing or corrupt"),e.errorsArry.push("MARS Error 06: Tariff data is missing or corrupt");break;case"99":console.log("Internal system error"),e.errorsArry.push("MARS Error 99: Internal system error");break;default:e.errorsArry.push("We have encountered an unknown MARS related error retreiving your shipment rating"),console.log("We have encountered an unknown MARS related error retreiving your shipment rating")}})},e.autoFillClient=function(a){for(var n in e.allCompanies)a===e.allCompanies[n].client_id&&(e.invoice.sender_name=e.allCompanies[n].client_name,e.invoice.sender_address_1=e.allCompanies[n].client_address_1,e.invoice.sender_address_2=e.allCompanies[n].client_address_2,e.invoice.sender_city=e.allCompanies[n].client_city,e.invoice.sender_zip=e.allCompanies[n].client_zip,e.invoice.sender_zip_4=e.allCompanies[n].client_zip_4,e.invoice.sender_country=e.allCompanies[n].client_country,e.invoice.sender_state=e.allCompanies[n].client_state,e.invoice.client_id=e.allCompanies[n].client_id,e.invoice.sender=e.allCompanies[n].client_name)},e.addRowItem=function(a){(a.length<10||void 0===a.length)&&(e.shippingClasses.push({weight:a.weight,classification:a.class,invoice_number:a.invoice_number}),e.PD={}),!1===e.newRow&&(e.newRow=!0)},e.addRowCharge=function(a){a||(a=[]),(a.length<12||void 0===a.length)&&(e.accessorialCharges.push({actual_cost:a.actual_cost,benchmark_cost:a.benchmark_cost,cost_code:a.cost_code,invoice_number:a.invoice_number}),e.PD={}),!1===e.newRow&&(e.newRow=!0)},e.remove=function(){var n=[],r=0;a.forEach(e.shippingClasses,function(e){e.selected||n.push(e)}),e.shippingClasses=n;for(var t in e.shippingClasses)e.shippingClasses[t].item_id||r++;var s=[];a.forEach(e.accessorialCharges,function(e){e.selected||s.push(e)}),e.accessorialCharges=s;for(t in e.accessorialCharges)e.accessorialCharges[t].cost_id||r++;e.shippingClasses.length<1&&e.addRowItem(e.shippingClasses),r<1&&(e.newRow=!1)},e.fuelChange=function(a){for(var n in e.allFuelRates)if(e.allFuelRates[n].fuel_rate_id===a){e.invoice.fuel_rate_id=e.allFuelRates[n].fuel_rate_id,e.invoice.fuel_date=e.allFuelRates[n].fuel_date,e.invoice.fuel_rate=e.allFuelRates[n].fuel_rate,e.invoice.fuel_surcharge=e.allFuelRates[n].fuel_surcharge;break}},e.autoFuelSurcharge=function(a){e.invoice.wrongDate=!1;var n,r=a.getDay(),t=moment(a);n=0===r||1===r||2===r?moment(t).day(-6):moment(t).day(1),t=new Date(n._d).toISOString().slice(0,10);for(var s in e.allFuelRates)if(e.allFuelRates[s].fuel_date=new Date(e.allFuelRates[s].fuel_date).toISOString().slice(0,10),e.allFuelRates[s].fuel_date===t){e.invoice.fuel_rate_id=e.allFuelRates[s].fuel_rate_id,e.invoice.fuel_date=e.allFuelRates[s].fuel_date,e.invoice.fuel_rate=e.allFuelRates[s].fuel_rate,e.invoice.fuel_surcharge=e.allFuelRates[s].fuel_surcharge;break}},e.deleteAccessorialCharge=function(a){var t=confirm("Are you sure you want to delete this Charge?");e.totalAccessorialCharges=0,e.totalBenchmarkCost=0;for(var s in e.accessorialCharges)e.totalAccessorialCharges+=e.accessorialCharges[s].actual_cost,e.totalBenchmarkCost+=e.accessorialCharges[s].benchmark_cost;e.totalAccessorialCharges-=a.actual_cost,e.totalBenchmarkCost-=a.benchmark_cost,!0===t&&(request="/secure-api/accessorial_cost_invoice/delete_associated_costs_invoice?"+a.cost_id+"/"+e.totalAccessorialCharges+"&"+e.totalBenchmarkCost+"|"+a.invoice_number,r.delete(request,d).then(function(e){n.reload(),console.log("Charge Removed")},function(e){console.log(e)}))},e.deleteShippingClass=function(a){var t=confirm("Are you sure you want to delete this Item?");e.totalWeight=0;for(var s in e.shippingClasses)e.totalWeight+=e.shippingClasses[s].weight;e.totalWeight-=a.weight,!0===t&&(request="/secure-api/shipping_class_invoice/delete_shipping_class_invoice?"+a.item_id+"/"+e.totalWeight+"|"+a.invoice_number,r.delete(request,d).then(function(e){n.reload(),console.log("Item Removed")},function(e){console.log(e)}))},e.changeCharge=function(a,n){for(var r in e.allAccessorialBenchmark)if(e.allAccessorialBenchmark[r].prebuilt_cost_id===n.prebuilt_cost_id){e.accessorialCharges[a].benchmark_cost=parseFloat(e.allAccessorialBenchmark[r].benchmark_cost),e.accessorialCharges[a].cost_code=e.allAccessorialBenchmark[r].cost_code;break}}}])}(window,window.angular),function(e,a,n){a.module("app").controller("invoiceListCtrl",["$scope","$state","$http","$stateParams","userSvc",function(e,n,r,t,s){var i={headers:{"auth-token":s.token}};e.allInvoices=[],e.to=new Date(moment().day(6)),e.from=new Date(moment().day(1)),e.selectAll=!1,e.errors=!1,e.errorsArry=[],e.exportToSavings=function(a,r){var t=[],s=[];for(var i in a)a[i].selected&&t.push(a[i].invoice_id);for(i in r)r[i].selected&&s.push(r[i].xpo_id);t.length+s.length>0?n.go("price-savings",{invoiceIDs:t,xpoIDs:s}):(console.log("Please select at least 1 invoice."),e.errors=!0,e.errorsArry=[],e.errorsArry.push("Please select at least 1 invoice."))},e.selectedAll=function(){e.selectAll?e.selectAll=!1:e.selectAll=!0,a.forEach(e.allInvoices,function(a){a.selected=e.selectAll}),a.forEach(e.allXPOInvoices,function(a){a.selected=e.selectAll})},e.AMCcheck=!1,e.grossCheck=!1,e.deficitCheck=!1,e.color="",e.rateCheck=function(e){var a="0"!==e.rated_sum&&0!==e.rated_sum,n=e.gross_charge!==e.rated_sum,r=e.deficit!==e.deficit_rate,t="";return(n||r)&&a&&(t="lightsalmon"),t},r.get("/secure-api/invoice/get_invoices_once",i).then(function(a){e.allInvoices=a.data.data;for(var n in e.allInvoices)e.allInvoices[n].process_date=date_parse(e.allInvoices[n].process_date),e.allInvoices[n].ship_date=date_parse(e.allInvoices[n].ship_date),e.allInvoices[n].delivery_date=date_parse(e.allInvoices[n].delivery_date),e.allInvoices[n].invoice_number=undoCleanEntry(e.allInvoices[n].invoice_number),e.allInvoices[n].sender_name=undoCleanEntry(e.allInvoices[n].sender_name),e.allInvoices[n].sender_address_1=undoCleanEntry(e.allInvoices[n].sender_address_1),e.allInvoices[n].sender_city=undoCleanEntry(e.allInvoices[n].sender_city),e.allInvoices[n].sender_country=undoCleanEntry(e.allInvoices[n].sender_country),e.allInvoices[n].receiver_name=undoCleanEntry(e.allInvoices[n].receiver_name),e.allInvoices[n].receiver_address_1=undoCleanEntry(e.allInvoices[n].receiver_address_1),e.allInvoices[n].receiver_city=undoCleanEntry(e.allInvoices[n].receiver_city),e.allInvoices[n].receiver_country=undoCleanEntry(e.allInvoices[n].receiver_country),e.allInvoices[n].transportation_mode=undoCleanEntry(e.allInvoices[n].transportation_mode),e.allInvoices[n].package_type=undoCleanEntry(e.allInvoices[n].package_type),e.allInvoices[n].receiver_zip_4=undoCleanEntry(e.allInvoices[n].receiver_zip_4),e.allInvoices[n].receiver_zip=undoCleanEntry(e.allInvoices[n].receiver_zip),e.allInvoices[n].sender_zip=undoCleanEntry(e.allInvoices[n].sender_zip),e.allInvoices[n].sender_zip_4=undoCleanEntry(e.allInvoices[n].sender_zip_4),e.allInvoices[n].carrier_name=undoCleanEntry(e.allInvoices[n].carrier_name)},function(e){console.log(e),n.go("login")}),r.get("/secure-api/xpo/get_XPO_invoices_once",i).then(function(a){e.allXPOInvoices=a.data.data;for(var n in e.allXPOInvoices)e.allXPOInvoices[n].invoice_number=e.allXPOInvoices[n].pro_number,e.allXPOInvoices[n].ship_date=date_parse(e.allXPOInvoices[n].ship_date),e.allXPOInvoices[n].process_date=date_parse(e.allXPOInvoices[n].process_date)},function(e){console.log(e),n.go("login")})}])}(window,window.angular),function(e,a,n){a.module("app").controller("priceSavingsCtrl",["$scope","$state","$http","$stateParams","userSvc",function(e,a,n,r,t){var s={headers:{"auth-token":t.token}};e.exportData=function(){setTimeout(function(){var a=new Blob([document.getElementById("savings_report").innerHTML],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),n=new Blob([document.getElementById("xpo_data").innerHTML],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),r=new Blob([document.getElementById("all_data").innerHTML],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"});saveAs(a,"Savings-Report-"+e.client_name+"-"+moment().format("YYYY/DD/MM")+".xls"),saveAs(n,"XPO-Data-"+e.client_name+"-"+moment().format("YYYY/DD/MM")+".xls"),saveAs(r,"All-Data-"+e.client_name+"-"+moment().format("YYYY/DD/MM")+".xls")},500)},e.savingsInvoices=[],e.associatedCosts=[],e.totalBenchmarkFrieghtCharge=0,e.totalBenchmarkCharge=0,e.totalBenchmarkAccessorial=0,e.totalFuelBenchmark=0,e.totalCharged=0,e.totalAccesorialCharge=0,e.totalFreightCharge=0,e.totalFuelCharge=0,e.state=a.current,e.params=r,e.recalculation=function(a,n){e.totalFuelBenchmark=0,e.totalBenchmarkAccessorial=0,e.totalBenchmarkFrieghtCharge=0,e.totalBenchmarkCharge=0,e.totalAccesorialCharge=0,e.totalCharged=0,e.totalFreightCharge=0,e.totalFuelCharge=0;for(var r in e.savingsInvoices)e.savingsInvoices[r].invoice_id===a.invoice_id&&(e.savingsInvoices[r]=a,"simple"===n?(e.savingsInvoices[r].benchmark_charge=e.savingsInvoices[r].benchmark_fuel_charge+e.savingsInvoices[r].freight_charge+e.savingsInvoices[r].benchamrk_access,e.savingsInvoices[r].savings_total_charge=e.savingsInvoices[r].savings_fuel_surcharge+e.savingsInvoices[r].savings_frieght_charge+e.savingsInvoices[r].assess_charge):"complex"===n&&(e.savingsInvoices[r].benchmark_fuel_charge=a.freight_charge*(a.benchmark_fuel_surcharge/100)*a.fsc_factor/100,e.savingsInvoices[r].benchmark_charge=Math.round(100*(e.savingsInvoices[r].benchmark_fuel_charge+e.savingsInvoices[r].freight_charge+e.savingsInvoices[r].total_benchmark))/100,e.savingsInvoices[r].savings_fuel_surcharge=Math.round(a.savings_frieght_charge*(a.fuel_surcharge/100)),e.savingsInvoices[r].savings_total_charge=Math.round(100*(e.savingsInvoices[r].savings_fuel_surcharge+e.savingsInvoices[r].savings_frieght_charge+e.savingsInvoices[r].assess_charge))/100)),e.totalFuelBenchmark+=e.savingsInvoices[r].benchmark_fuel_charge,e.totalBenchmarkAccessorial+=parseFloat(e.savingsInvoices[r].total_benchmark),e.totalBenchmarkFrieghtCharge+=e.savingsInvoices[r].freight_charge,e.totalBenchmarkCharge+=e.savingsInvoices[r].benchmark_charge,e.totalAccesorialCharge+=parseFloat(e.savingsInvoices[r].total_associated_costs),e.totalCharged+=e.savingsInvoices[r].savings_total_charge,e.totalFreightCharge+=e.savingsInvoices[r].savings_frieght_charge,e.totalFuelCharge+=parseFloat(e.savingsInvoices[r].savings_fuel_surcharge);for(r in e.savingsXPOInvoices)e.totalBenchmarkFrieghtCharge+=parseFloat(e.savingsXPOInvoices[r].old_cost),e.totalFuelBenchmark+=parseFloat(e.savingsXPOInvoices[r].old_fsc),e.totalBenchmarkCharge+=parseFloat(e.savingsXPOInvoices[r].old_total_cost),e.totalFreightCharge+=parseFloat(e.savingsXPOInvoices[r].new_cost),e.totalFuelCharge+=parseFloat(e.savingsXPOInvoices[r].new_fsc),e.totalCharged+=parseFloat(e.savingsXPOInvoices[r].new_total_cost)},e.calculation=function(){e.totalFuelBenchmark=0,e.totalBenchmarkAccessorial=0,e.totalBenchmarkFrieghtCharge=0,e.totalBenchmarkCharge=0,e.totalAccesorialCharge=0,e.totalCharged=0,e.totalFreightCharge=0,e.totalFuelCharge=0;for(var a=0;a<e.savingsInvoices.length;a++){e.savingsInvoices[a].process_date=new Date(e.savingsInvoices[a].process_date),e.savingsInvoices[a].ship_date=new Date(e.savingsInvoices[a].ship_date),e.savingsInvoices[a].delivery_date=new Date(e.savingsInvoices[a].delivery_date),e.savingsInvoices[a].carrier_discount=Math.round(100*e.savingsInvoices[a].carrier_discount),e.savingsInvoices[a].discount=Math.round(1e4*e.savingsInvoices[a].discount)/100,e.savingsInvoices[a].gross_charge=parseFloat(e.savingsInvoices[a].gross_charge),e.savingsInvoices[a].absolute_min_charge=parseFloat(e.savingsInvoices[a].absolute_min_charge),e.savingsInvoices[a].fsc_factor=Math.round(1e4*e.savingsInvoices[a].fsc_factor)/100,e.savingsInvoices[a].bmfsc_factor=e.savingsInvoices[a].fsc_factor+"%",e.savingsInvoices[a].fuel_surcharge=Math.round(1e4*e.savingsInvoices[a].fuel_surcharge)/100,e.savingsInvoices[a].benchmark_fuel_surcharge=Math.round(1e4*e.savingsInvoices[a].benchmark_fuel_surcharge)/100,e.savingsInvoices[a].bfsc_percent=e.savingsInvoices[a].benchmark_fuel_surcharge+"%",e.savingsInvoices[a].accelerated_charge=parseFloat(e.savingsInvoices[a].accelerated_charge),e.savingsInvoices[a].deficit=parseFloat(e.savingsInvoices[a].deficit),e.savingsInvoices[a].rated_sum=parseFloat(e.savingsInvoices[a].rated_sum),e.savingsInvoices[a].deficit_rate=parseFloat(e.savingsInvoices[a].deficit_rate),e.savingsInvoices[a].benchamrk_access=parseFloat(e.savingsInvoices[a].benchamrk_access),e.savingsInvoices[a].assess_charge=parseFloat(e.savingsInvoices[a].assess_charge);var n=0,r=0;5===e.savingsInvoices[a].carrier_id?(n=e.savingsInvoices[a].rated_sum,r=e.savingsInvoices[a].deficit_rate):(n=e.savingsInvoices[a].gross_charge,r=e.savingsInvoices[a].deficit),(n+r)*(100-e.savingsInvoices[a].discount)/100<=88.39?(e.savingsInvoices[a].freight_charge=88.39,e.savingsInvoices[a].bmdiscount="AMC"):(e.savingsInvoices[a].bmdiscount=e.savingsInvoices[a].discount+"%",e.savingsInvoices[a].freight_charge=Math.round((n+r)*(100-e.savingsInvoices[a].discount))/100),(e.savingsInvoices[a].gross_charge+e.savingsInvoices[a].deficit_rate)*(100-e.savingsInvoices[a].carrier_discount)/100<=e.savingsInvoices[a].absolute_min_charge?(e.savingsInvoices[a].savings_discount="AMC",e.savingsInvoices[a].savings_frieght_charge=e.savingsInvoices[a].absolute_min_charge):(e.savingsInvoices[a].savings_discount=e.savingsInvoices[a].carrier_discount+"%",e.savingsInvoices[a].savings_frieght_charge=Math.round((e.savingsInvoices[a].gross_charge+e.savingsInvoices[a].deficit)*(100-e.savingsInvoices[a].carrier_discount))/100),!0===e.savingsInvoices[a].accelerated_service?(e.savingsInvoices[a].savings_accelerated_charge=Math.round(e.savingsInvoices[a].savings_frieght_charge*e.savingsInvoices[a].accelerated_charge*100)/100,e.savingsInvoices[a].benchmark_accelerated_charge=Math.round(e.savingsInvoices[a].freight_charge*e.savingsInvoices[a].accelerated_charge*100)/100,e.savingsInvoices[a].savings_accelerated_charge<30&&(e.savingsInvoices[a].savings_accelerated_charge=30,e.savingsInvoices[a].benchmark_accelerated_charge<e.savingsInvoices[a].savings_accelerated_charge&&(e.savingsInvoices[a].benchmark_accelerated_charge=e.savingsInvoices[a].savings_accelerated_charge)),e.savingsInvoices[a].total_associated_costs=parseFloat(e.savingsInvoices[a].total_associated_costs)+e.savingsInvoices[a].savings_accelerated_charge,e.savingsInvoices[a].total_benchmark=parseFloat(e.savingsInvoices[a].total_benchmark)+e.savingsInvoices[a].savings_accelerated_charge):(e.savingsInvoices[a].savings_accelerated_charge=0,e.savingsInvoices[a].benchmark_accelerated_charge=0,e.savingsInvoices[a].total_associated_costs=parseFloat(e.savingsInvoices[a].total_associated_costs),e.savingsInvoices[a].total_benchmark=parseFloat(e.savingsInvoices[a].total_benchmark));var t=0;t=e.savingsInvoices[a].freight_charge,t=e.savingsInvoices[a].freight_charge+e.savingsInvoices[a].savings_accelerated_charge,e.savingsInvoices[a].savings_fuel_surcharge=Math.round((e.savingsInvoices[a].savings_frieght_charge+e.savingsInvoices[a].savings_accelerated_charge)*(e.savingsInvoices[a].fuel_surcharge/100)*100)/100,e.savingsInvoices[a].benchmark_fuel_charge=Math.round(e.savingsInvoices[a].benchmark_fuel_surcharge/100*e.savingsInvoices[a].fsc_factor/100*t*100)/100,e.savingsInvoices[a].savings_total_charge=Math.round(100*(parseFloat(e.savingsInvoices[a].savings_frieght_charge)+parseFloat(e.savingsInvoices[a].savings_fuel_surcharge)+parseFloat(e.savingsInvoices[a].total_associated_costs)))/100,e.savingsInvoices[a].benchmark_charge=e.savingsInvoices[a].benchmark_fuel_charge+e.savingsInvoices[a].freight_charge+e.savingsInvoices[a].total_benchmark,e.totalFuelBenchmark+=e.savingsInvoices[a].benchmark_fuel_charge,e.totalBenchmarkAccessorial+=parseFloat(e.savingsInvoices[a].total_benchmark),e.totalBenchmarkFrieghtCharge+=e.savingsInvoices[a].freight_charge,e.totalBenchmarkCharge+=e.savingsInvoices[a].benchmark_charge,e.totalAccesorialCharge+=parseFloat(e.savingsInvoices[a].total_associated_costs),e.totalCharged+=e.savingsInvoices[a].savings_total_charge,e.totalFreightCharge+=e.savingsInvoices[a].savings_frieght_charge,e.totalFuelCharge+=parseFloat(e.savingsInvoices[a].savings_fuel_surcharge)}for(a in e.savingsXPOInvoices)e.totalBenchmarkFrieghtCharge+=parseFloat(e.savingsXPOInvoices[a].old_cost),e.totalFuelBenchmark+=parseFloat(e.savingsXPOInvoices[a].old_fsc),e.totalBenchmarkCharge+=parseFloat(e.savingsXPOInvoices[a].old_total_cost),e.totalFreightCharge+=parseFloat(e.savingsXPOInvoices[a].new_cost),e.totalFuelCharge+=parseFloat(e.savingsXPOInvoices[a].new_fsc),e.totalCharged+=parseFloat(e.savingsXPOInvoices[a].new_total_cost)},e.params.invoiceIDs?n.get("/secure-api/invoice/get_invoices_price_savings?"+e.params.invoiceIDs,s).then(function(a){e.savingsInvoices=a.data.data;for(var r in e.savingsInvoices)e.savingsInvoices[r].carrier_name=undoCleanEntry(e.savingsInvoices[r].carrier_name),e.savingsInvoices[r].invoice_number=undoCleanEntry(e.savingsInvoices[r].invoice_number),e.savingsInvoices[r].receiver_name=undoCleanEntry(e.savingsInvoices[r].receiver_name),e.savingsInvoices[r].receiver_zip=undoCleanEntry(e.savingsInvoices[r].receiver_zip),e.savingsInvoices[r].process_date=date_parse(e.savingsInvoices[r].process_date),e.savingsInvoices[r].ship_date=date_parse(e.savingsInvoices[r].ship_date),e.savingsInvoices[r].delivery_date=date_parse(e.savingsInvoices[r].delivery_date),e.savingsInvoices[r].ACCSCosts=[],e.savingsInvoices[r].shipped_Item=[];e.process_date=e.savingsInvoices[0].process_date,e.client_name=e.savingsInvoices[0].client_name,e.params.xpoIDs?n.get("/secure-api/xpo/get_xpo_invoices_price_savings?"+e.params.xpoIDs,s).then(function(a){e.savingsXPOInvoices=a.data.data;for(r in e.savingsXPOInvoices)e.savingsXPOInvoices[r].ship_date=date_parse(e.savingsXPOInvoices[r].ship_date),e.savingsXPOInvoices[r].process_date=date_parse(e.savingsXPOInvoices[r].process_date),e.savingsXPOInvoices[r].invoice_number=e.savingsXPOInvoices[r].pro_number,e.savingsXPOInvoices[r].discount_percent=Math.round(1e4*e.savingsXPOInvoices[r].discount_percent)/100;e.getAssoccClass(),e.calculation()},function(e){console.log(e)}):(e.getAssoccClass(),e.calculation())},function(e){console.log(e)}):n.get("/secure-api/xpo/get_xpo_invoices_price_savings?"+e.params.xpoIDs,s).then(function(a){e.savingsXPOInvoices=a.data.data,console.log(a.data.data);for(var n in e.savingsXPOInvoices)e.savingsXPOInvoices[n].ship_date=date_parse(e.savingsXPOInvoices[n].ship_date),e.savingsXPOInvoices[n].process_date=date_parse(e.savingsXPOInvoices[n].process_date),e.savingsXPOInvoices[n].invoice_number=e.savingsXPOInvoices[n].pro_number,e.savingsXPOInvoices[n].discount_percent=Math.round(1e4*e.savingsXPOInvoices[n].discount_percent)/100;e.process_date=e.savingsXPOInvoices[0].process_date,e.client_name=e.savingsXPOInvoices[0].client_name,e.calculation()},function(e){console.log(e)}),e.getAssoccClass=function(){n.get("/secure-api/accessorial_cost_invoice/get_associated_costs_invoices",s).then(function(a){e.ACCSCosts=a.data.data;for(var n in e.ACCSCosts){e.ACCSCosts[n].invoice_number=undoCleanEntry(e.ACCSCosts[n].invoice_number);for(var r in e.savingsInvoices)e.ACCSCosts[n].invoice_number===e.savingsInvoices[r].invoice_number&&e.savingsInvoices[r].ACCSCosts.push(e.ACCSCosts[n])}},function(e){console.log(e)}),n.get("/secure-api/shipping_class_invoice/get_shipping_class_invoice",s).then(function(a){e.shipped_Item=a.data.data;for(var n in e.shipped_Item){e.shipped_Item[n].invoice_number=undoCleanEntry(e.shipped_Item[n].invoice_number);for(var r in e.savingsInvoices)e.shipped_Item[n].invoice_number===e.savingsInvoices[r].invoice_number&&e.savingsInvoices[r].shipped_Item.push(e.shipped_Item[n])}},function(e){console.log(e)}),console.log(e.savingsInvoices.length)}}])}(window,window.angular),function(e,a,n){a.module("app").controller("invoiceViewCtrl",["$scope","$state","$http","$stateParams","userSvc",function(e,a,n,r,t){var s={headers:{"auth-token":t.token}};e.specificInvoice=[],e.associatedCosts=[],e.state=a.current,e.params=r,n.get("/secure-api/invoice/get_invoice?"+e.params.invoiceID,s).then(function(a){e.specificInvoice=a.data.data;for(var r=0;r<e.specificInvoice.length;r++)e.specificInvoice[r].process_date=date_parse(e.specificInvoice[r].process_date),e.specificInvoice[r].ship_date=date_parse(e.specificInvoice[r].ship_date),e.specificInvoice[r].delivery_date=date_parse(e.specificInvoice[r].delivery_date),e.specificInvoice[r].carrier_discount=Math.round(100*e.specificInvoice[r].carrier_discount),e.specificInvoice[r].invoice_number=undoCleanEntry(e.specificInvoice[r].invoice_number),e.specificInvoice[r].sender_name=undoCleanEntry(e.specificInvoice[r].sender_name),e.specificInvoice[r].sender_address_1=undoCleanEntry(e.specificInvoice[r].sender_address_1),e.specificInvoice[r].sender_city=undoCleanEntry(e.specificInvoice[r].sender_city),e.specificInvoice[r].sender_country=undoCleanEntry(e.specificInvoice[r].sender_country),e.specificInvoice[r].receiver_name=undoCleanEntry(e.specificInvoice[r].receiver_name),e.specificInvoice[r].receiver_address_1=undoCleanEntry(e.specificInvoice[r].receiver_address_1),e.specificInvoice[r].receiver_city=undoCleanEntry(e.specificInvoice[r].receiver_city),e.specificInvoice[r].receiver_country=undoCleanEntry(e.specificInvoice[r].receiver_country),e.specificInvoice[r].transportation_mode=undoCleanEntry(e.specificInvoice[r].transportation_mode),e.specificInvoice[r].package_type=undoCleanEntry(e.specificInvoice[r].package_type),e.specificInvoice[r].receiver_zip_4=undoCleanEntry(e.specificInvoice[r].receiver_zip_4),e.specificInvoice[r].receiver_zip=undoCleanEntry(e.specificInvoice[r].receiver_zip),e.specificInvoice[r].sender_zip=undoCleanEntry(e.specificInvoice[r].sender_zip),e.specificInvoice[r].sender_zip_4=undoCleanEntry(e.specificInvoice[r].sender_zip_4);e.items=e.specificInvoice,n.get("/secure-api/accessorial_cost_invoice/get_associated_costs_invoice?"+e.specificInvoice[0].invoice_number,s).then(function(a){e.associatedCosts=a.data.data},function(e){console.log(e)})},function(e){console.log(e),a.go("login")}),e.deleteInvoice=function(e){!0===confirm("Are you sure you want to delete this Invoice?")&&(request="/secure-api/invoice/delete_invoice?"+e,n.delete(request,s).then(function(e){console.log("Invoice Removed"),a.go("list-invoice")},function(e){console.log(e),a.go("login")}))}}])}(window,window.angular),function(e,a,n){a.module("app").controller("viewXPOInvoice",["$scope","$state","$http","$stateParams","userSvc",function(e,a,n,r,t){var s={headers:{"auth-token":t.token}};e.state=a.current,e.params=r,e.xpoInvoice={},e.deleteXPOInvoice=function(e){!0===confirm("Are you sure you want to delete this Invoice?")&&(request="/secure-api/xpo/delete_xpo_invoice?"+e,n.delete(request,s).then(function(e){console.log("Invoice Removed"),a.go("list-invoice")},function(e){console.log(e),a.go("login")}))},n.get("/secure-api/xpo/get_xpo_invoice?"+e.params.invoiceID,s).then(function(a){e.xpoInvoice=a.data.data,e.xpoInvoice[0].ship_date=date_parse(e.xpoInvoice[0].ship_date),e.xpoInvoice[0].process_date=date_parse(e.xpoInvoice[0].process_date),e.xpoInvoice[0].discount_percent=sanatizePercent(e.xpoInvoice[0].discount_percent)},function(e){console.log(e),a.go("login")})}])}(window,window.angular),function(e,a,n){a.module("app").controller("iotCtrl",["$scope","$state","userSvc","iotSvc",function(e,a,n,r){var t={headers:{"auth-token":n.token}};e.allIOT=[],e.newIOT={},e.getEverything=function(a){r.getIOT(a).then(function(a){e.allIOT=a})},e.getEverything(t),e.submitIOT=function(a){a.delivery_type=cleanEntry(a.delivery_type),a.discount=sanatizePercent(a.discount),a.fsc_factor=sanatizePercent(a.fsc_factor),a.iot_id?r.updateIOT(a,t):(r.sumbitIOT(a,t),e.newIOT={})},e.deleteIOT=function(a){if(confirm("Are you sure you want to delete this IOT?")){request="/secure-api/iot/delete_iot/?"+a,r.deleteIOT(request,t);for(var n in e.allIOT)e.allIOT[n].iot_id===a&&e.allIOT.splice(n,1)}}}])}(window,window.angular),function(e,a,n){a.module("app").controller("benchmarkFSCCtrl",["$scope","$state","userSvc","benchmarkSvc",function(e,a,n,r){var t={headers:{"auth-token":n.token}};e.allBenchmarkFSC=[],e.getEverything=function(a){r.getBenchmark(a).then(function(a){e.allBenchmarkFSC=a})},e.getEverything(t),e.submitBenchmarkFSC=function(a){var n=!1;for(var s in e.allBenchmarkFSC)if(e.allBenchmarkFSC[s].fuel_index===a.fuel_index&&a.benchmark_fsc_id!==e.allBenchmarkFSC[s].benchmark_fsc_id){console.log("That rate is already covered please enter a diffrent rate"),n=!0;break}n||(a.benchmark_fuel_surcharge=sanatizePercent(a.benchmark_fuel_surcharge),a.benchmark_fsc_id?r.updateBenchmark(a,t):(r.sumbitBenchmark(a,t),e.newCarrier={}))},e.deleteBenchmarkFSC=function(a){if(confirm("Are you sure you want to delete this Benchmark?")){request="/secure-api/benchmark_fsc/delete_benchmark_fsc/?"+a,r.deleteBenchmark(request,t);for(var n in e.allBenchmarkFSC)e.allBenchmarkFSC[n].benchmark_fsc_id===a&&e.allBenchmarkFSC.splice(n,1)}}}])}(window,window.angular),function(e,a,n){a.module("app").controller("carrierCtrl",["$scope","$state","userSvc","carrierSvc",function(e,a,n,r){var t={headers:{"auth-token":n.token}};e.newCarrier={},e.allCarriers=[],e.getCarriers=function(a){r.getCarriers(a).then(function(a){e.allCarriers=a})},e.getCarriers(t),e.submitCarrier=function(a){a.carrier_name=cleanEntry(a.carrier_name),a.carrier_id?r.updateCarriers(a,t):(r.sumbitCarriers(a,t),e.newCarrier={})},e.deleteCarrier=function(a){if(confirm("Are you sure you want to delete this Carrier?")){request="/secure-api/carrier/delete_carrier/?"+a,r.deleteCarriers(request,t);for(var n in e.allCarriers)e.allCarriers[n].carrier_id===a&&e.allCarriers.splice(n,1)}}}])}(window,window.angular),function(e,a,n){a.module("app").controller("fuelRatesCtrl",["$scope","$state","userSvc","benchmarkSvc","fscsSvc","fuelRateService",function(e,a,n,r,t,s){var i={headers:{"auth-token":n.token}};e.allFuelRates=[],e.allFscs=[],e.limit=100,e.allBenchmarkFSC=[],e.getEverything=function(a){r.getBenchmark(a).then(function(a){e.allBenchmarkFSC=a}),t.getFscs(a).then(function(a){e.allFscs=a}),s.getFuelRate(a).then(function(a){e.allFuelRates=a})},e.getEverything(i),e.submitFuelRate=function(a){a.fuel_rate_rounded=Math.floor(100*a.fuel_rate);for(var n in e.allBenchmarkFSC)a.fuel_rate_rounded===e.allBenchmarkFSC[n].fuel_index&&(a.benchmark_fuel_surcharge=e.allBenchmarkFSC[n].benchmark_fuel_surcharge);if(a.benchmark_fuel_surcharge||(a.benchmark_fuel_surcharge=null),a.fuel_rate<2)a.fuel_surcharge=0;else for(var r in e.allFscs)e.allFscs[r].start_rate<=a.fuel_rate&&a.fuel_rate<=e.allFscs[r].end_rate&&(a.fuel_surcharge=e.allFscs[r].fuel_surcharge);a.fuel_rate_id?s.updateFuelRate(a,i):(s.sumbitFuelRate(a,i),e.newFSC={})},e.deleteFuelRate=function(a){if(confirm("Are you sure you want to delete this Fuel Rate?")){request="/secure-api/fuel_rates/delete_fuel_rate/?"+a,s.deleteFuelRate(request,i);for(var n in e.allFuelRates)e.allFuelRates[n].fuel_rate_id===a&&e.allFuelRates.splice(n,1)}},e.sortBy=function(a){e.reverse=null!==a&&e.propertyName===a&&!e.reverse,e.propertyName=a},e.increaseLimit=function(){e.limit+=100,console.log(e.limit)}}])}(window,window.angular),function(e,a,n){a.module("app").controller("fscCtrl",["$scope","$state","userSvc","fscsSvc",function(e,a,n,r){var t={headers:{"auth-token":n.token}};e.allFscs=[],e.newFSC={},e.getEverything=function(a){r.getFscs(a).then(function(a){e.allFscs=a})},e.getEverything(t),e.submitFSC=function(a){var n=!1;if(a.start_rate<a.end_rate){for(var s in e.allFscs)if(e.allFscs[s].start_rate<=a.start_rate&&e.allFscs[s].end_rate>=a.start_rate&&a.fuel_surcharge_id!==e.allFscs[s].fuel_surcharge_id){console.log("That rate is already covered please enter a diffrent rate"),n=!0;break}n||(a.fuel_surcharge=sanatizePercent(a.fuel_surcharge),a.fuel_surcharge_id?r.updateFscs(a,t):(r.sumbitFscs(a,t),e.newFSC={}))}else console.log("Starting Rate must be lower than ending rate")},e.deleteFSC=function(a){if(confirm("Are you sure you want to delete this Fuel Surcharge?")){request="/secure-api/fuel_surcharge_rates/delete_fsc/?"+a,r.deleteFscs(request,t);for(var n in e.allFscs)e.allFscs[n].fuel_surcharge_id===a&&e.allFscs.splice(n,1)}}}])}(window,window.angular),function(e,a,n){a.module("app").controller("operationalAreaCtrl",["$scope","$state","userSvc","carrierSvc","operationAreaSvc","regionSvc","statesSvc",function(e,a,n,r,t,s,i){var o={headers:{"auth-token":n.token}};e.limit=100,e.allCarriers=[],e.allOperations=[],e.allRegions=[],e.allStates=[],e.newOperationalArea={},e.getEverything=function(a){r.getCarriers(a).then(function(a){e.allCarriers=a}),t.getOperationalArea(a).then(function(a){e.allOperations=a}),s.getRegion(a).then(function(a){e.allRegions=a}),i.getStates(a).then(function(a){e.allStates=a})},e.getEverything(o),e.submitOperationalArea=function(a){for(var n in e.allStates)e.allStates[n].state_id===a.state_id&&(a.states=e.allStates[n].states);a.accelerated_charge||(a.accelerated_charge=0),void 0!==a.zip_code&&""!==a.zip_code&&null!==a.zip_code||(a.zip_code=""),a.zip_code=cleanEntry(a.zip_code),a.discount=sanatizePercent(a.discount),a.accelerated_charge=sanatizePercent(a.accelerated_charge),a.operation_id?t.updateOperationalArea(a,o):(t.sumbitOperationalArea(a,o),e.newOperationalArea={})},e.massUpdate=function(e){e.discount=sanatizePercent(e.discount),e.accelerated_charge=sanatizePercent(e.accelerated_charge),t.updateMass(e,o)},e.sortBy=function(a){e.reverse=null!==a&&e.propertyName===a&&!e.reverse,e.propertyName=a},e.update_list=function(a){e.selectedRegion=[];for(var n in e.allRegions)e.allRegions[n].state_id===a&&e.selectedRegion.push(e.allRegions[n])},e.increaseLimit=function(){e.limit+=100,console.log(e.limit)},e.deleteOperationalArea=function(a){if(confirm("Are you sure you want to delete this Operational Area?")){request="/secure-api/operational_area/delete_operational_area/?"+a,t.deleteOperationalArea(request,o);for(var n in e.allOperations)e.allOperations[n].operation_id===a&&e.allOperations.splice(n,1)}}}])}(window,window.angular),function(e,a,n){a.module("app").controller("accessorialCtrl",["$scope","$state","userSvc","accessSvc",function(e,a,n,r){var t={headers:{"auth-token":n.token}};e.newAccessorialCharge={},e.allAccessorial=[],e.getAccess=function(a){r.getAccess(a).then(function(a){e.allAccessorial=a})},e.getAccess(t),e.submitAccessorialCharge=function(a){a.description=cleanEntry(a.description),a.cost_code=cleanEntry(a.cost_code),a.prebuilt_cost_id?r.updateAccess(a,t):(r.sumbitAccess(a,t),e.newAccessorialCharge={})},e.deleteAccessorialCharge=function(a){if(confirm("Are you sure you want to delete this State?")){request="/secure-api/accessorial_cost/delete_prebuilt_associated_costs/?"+a,r.deleteAccess(request,t);for(var n in e.allAccessorial)e.allAccessorial[n].prebuilt_cost_id===a&&e.allAccessorial.splice(n,1)}}}])}(window,window.angular),function(e,a,n){a.module("app").controller("stateRegionCtrl",["$scope","$state","userSvc","regionSvc","statesSvc",function(e,a,n,r,t){var s={headers:{"auth-token":n.token}};e.allRegions=[],e.newRegion={},e.allStates=[],e.newState={},e.getEverything=function(a){r.getRegion(a).then(function(a){e.allRegions=a}),t.getStates(a).then(function(a){e.allStates=a})},e.getEverything(s),e.submitRegion=function(a){for(var n in e.allRegions)e.allRegions[n].state_id===a.state_id&&(a.states=e.allRegions[n].states);a.region=cleanEntry(a.region),a.state_region_id?r.updateRegion(a,s):(r.sumbitRegion(a,s),e.newRegion={})},e.submitState=function(a){a.states=cleanEntry(a.states),a.state_id?t.updateStates(a,s):(t.sumbitStates(a,s),e.newState={})},e.deleteRegion=function(a){if(confirm("Are you sure you want to delete this Region?")){request="/secure-api/region/delete_region/?"+a,r.deleteRegion(request,s);for(var n in e.allRegions)e.allRegions[n].state_region_id===a&&e.allRegions.splice(n,1)}},e.deleteState=function(a){if(confirm("Are you sure you want to delete this State?")){request="/secure-api/states/delete_state/?"+a,r.deleteRegion(request,s);for(var n in e.allStates)e.allStates[n].state_id===a&&e.allStates.splice(n,1)}}}])}(window,window.angular),function(e,a,n){a.module("app").service("accessSvc",["$http","$q","$state",function(e,a,n){var r=this,t=[];r.getAccess=function(r,s){var i=a.defer();return e.get("/secure-api/accessorial_cost/get_prebuilt_associated_costs",r).then(function(e){t=e.data.data;for(var a in t)t[a].benchmark_cost=parseFloat(t[a].benchmark_cost),t[a].description=undoCleanEntry(t[a].description),t[a].cost_code=undoCleanEntry(t[a].cost_code);i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.sumbitAccess=function(r,t,s){var i=a.defer();e.post("/secure-api/accessorial_cost/insert_prebuilt_associated_costs",r,t).then(function(e){console.log("Prebuilt Accessorial Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateAccess=function(n,r,t){var s=a.defer();e.put("/secure-api/accessorial_cost/update_prebuilt_associated_costs",n,r).then(function(e){console.log("Prebuilt Accessorial Updated")}).catch(function(e){s.reject(e)})},r.deleteAccess=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("Prebuilt Accessorial Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("benchmarkSvc",["$http","$q","$state",function(e,a,n){var r=this,t=[];r.getBenchmark=function(r,s){var i=a.defer();return e.get("/secure-api/benchmark_fsc/get_benchmark_fsc",r).then(function(e){t=e.data.data;for(var a in t)t[a].benchmark_fuel_surcharge_percent=Math.round(1e4*t[a].benchmark_fuel_surcharge)/100+"%",t[a].fuel_index=parseFloat(t[a].fuel_index),t[a].benchmark_fuel_surcharge=parseFloat(t[a].benchmark_fuel_surcharge);i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.sumbitBenchmark=function(r,t,s){var i=a.defer();e.post("/secure-api/benchmark_fsc/insert_benchmark_fsc",r,t).then(function(e){console.log("Fuel Surcharge Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateBenchmark=function(n,r,t){var s=a.defer();e.put("/secure-api/benchmark_fsc/update_benchmark_fsc",n,r).then(function(e){console.log("Fuel Surcharge Updated")}).catch(function(e){s.reject(e)})},r.deleteBenchmark=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("Benchmark FSC Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("carrierSvc",["$http","$q","$state",function(e,a,n){var r=this,t=[];r.getCarriers=function(r,s){var i=a.defer();return e.get("/secure-api/carrier/get_carriers",r).then(function(e){t=e.data.data;for(var a in t)t[a].carrier_name=undoCleanEntry(t[a].carrier_name);i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.sumbitCarriers=function(r,t,s){var i=a.defer();e.post("/secure-api/carrier/insert_carriers",r,t).then(function(e){console.log("Fuel Surcharge Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateCarriers=function(n,r,t){var s=a.defer();e.put("/secure-api/carrier/update_carrier",n,r).then(function(e){console.log("Fuel Surcharge Updated")}).catch(function(e){s.reject(e)})},r.deleteCarriers=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("Fuel Surcharge Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("clientSvc",["$http","$q","$state",function(e,a,n){var r=this,t=[];r.getClients=function(r,s){var i=a.defer();return e.get("/secure-api/company/get_companies",r).then(function(e){t=e.data.data;for(var a in t)t[a].client_address_1=undoCleanEntry(t[a].client_address_1),t[a].client_city=undoCleanEntry(t[a].client_city),t[a].client_name=undoCleanEntry(t[a].client_name),t[a].client_country=undoCleanEntry(t[a].client_country),t[a].client_address_2&&(t[a].client_address_2=undoCleanEntry(t[a].client_address_2));i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.sumbitClients=function(r,t,s){console.log("test");var i=a.defer();e.post("/secure-api/company/insert_company",r,t).then(function(e){console.log("Client Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateClients=function(n,r,t){console.log("test");var s=a.defer();e.put("/secure-api/company/update_company",n,r).then(function(e){console.log("Client Updated")}).catch(function(e){s.reject(e)})},r.deleteClients=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("Client Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("fscsSvc",["$http","$q","$state",function(e,a,n){var r=this,t=[];r.getFscs=function(r,s){var i=a.defer();return e.get("/secure-api/fuel_surcharge_rates/get_fsc",r).then(function(e){t=e.data.data;for(var a in t)t[a].fuel_surcharge_percent=Math.round(1e4*t[a].fuel_surcharge)/100+"%",t[a].start_rate=parseFloat(t[a].start_rate),t[a].end_rate=parseFloat(t[a].end_rate),t[a].fuel_surcharge=parseFloat(t[a].fuel_surcharge);i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.sumbitFscs=function(r,t,s){var i=a.defer();e.post("/secure-api/fuel_surcharge_rates/insert_fsc",r,t).then(function(e){console.log("Fuel Surcharge Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateFscs=function(n,r,t){var s=a.defer();e.put("/secure-api/fuel_surcharge_rates/update_fsc",n,r).then(function(e){console.log("Fuel Surcharge Updated")}).catch(function(e){s.reject(e)})},r.deleteFscs=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("Fuel Surcharge Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("fuelRateService",["$http","$q","$state",function(e,a,n){var r=this,t=[];r.getFuelRate=function(r,s){var i=a.defer();return e.get("/secure-api/fuel_rates/get_fuel_rates",r).then(function(e){t=e.data.data;for(var a=0;a<t.length;a++)t[a].fuel_date=date_parse(t[a].fuel_date),t[a].fuel_date_display=moment(t[a].fuel_date).format("YYYY/MM/DD");i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.sumbitFuelRate=function(r,t,s){var i=a.defer();e.post("/secure-api/fuel_rates/insert_fuel_rate",r,t).then(function(e){console.log("Fuel Surcharge Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateFuelRate=function(n,r,t){var s=a.defer();e.put("/secure-api/fuel_rates/update_fuel_rate",n,r).then(function(e){console.log("Fuel Surcharge Updated")}).catch(function(e){s.reject(e)})},r.deleteFuelRate=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("Fuel Surcharge Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("invoiceSvc",["$http","$q","$state",function(e,a,n){var r=this;r.getFscs=function(r,t){var s=a.defer();return e.get("/secure-api/fuel_surcharge_rates/get_fsc",r).then(function(e){allFscs=e.data.data;for(var a in allFscs)allFscs[a].fuel_surcharge_percent=Math.round(1e4*allFscs[a].fuel_surcharge)/100+"%",allFscs[a].start_rate=parseFloat(allFscs[a].start_rate),allFscs[a].end_rate=parseFloat(allFscs[a].end_rate),allFscs[a].fuel_surcharge=parseFloat(allFscs[a].fuel_surcharge);s.resolve(allFscs)}).catch(function(e){s.reject(e),n.go("login")}),s.promise},r.sumbitFscs=function(r,t,s){var i=a.defer();e.post("/secure-api/fuel_surcharge_rates/insert_fsc",r,t).then(function(e){console.log("Fuel Surcharge Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateFscs=function(n,r,t){var s=a.defer();e.put("/secure-api/fuel_surcharge_rates/update_fsc",n,r).then(function(e){console.log("Fuel Surcharge Updated")}).catch(function(e){s.reject(e)})},r.deleteFscs=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("Fuel Surcharge Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("iotSvc",["$http","$q","$state",function(e,a,n){var r=this,t=[];r.getIOT=function(r,s){var i=a.defer();return e.get("/secure-api/iot/get_iot",r).then(function(e){t=e.data.data;for(var a in t)t[a].delivery_type=cleanEntry(t[a].delivery_type);i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.sumbitIOT=function(r,t,s){var i=a.defer();e.post("/secure-api/iot/insert_IOT",r,t).then(function(e){console.log("IOT Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateIOT=function(n,r,t){var s=a.defer();e.put("/secure-api/iot/update_iot",n,r).then(function(e){console.log("IOT Updated")}).catch(function(e){s.reject(e)})},r.deleteIOT=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("IOT Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("operationAreaSvc",["$http","$q","$state",function(e,a,n){var r=this,t=[];r.getOperationalArea=function(r,s){var i=a.defer();return e.get("/secure-api/operational_area/get_operational_area",r).then(function(e){t=e.data.data;for(var a=0;a<t.length;a++)t[a].absolute_minimum_charge=parseFloat(t[a].absolute_minimum_charge),t[a].accelerated_charge&&(t[a].accelerated_charge=parseFloat(t[a].accelerated_charge)),t[a].zip_code&&(t[a].zip_code=undoCleanEntry(t[a].zip_code)),t[a].region=undoCleanEntry(t[a].region),t[a].carrier_name=undoCleanEntry(t[a].carrier_name);i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.sumbitOperationalArea=function(r,t,s){var i=a.defer();e.post("/secure-api/operational_area/insert_operational_area",r,t).then(function(e){console.log("Operational Area Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateOperationalArea=function(n,r,t){var s=a.defer();e.put("/secure-api/operational_area/update_operational_area",n,r).then(function(e){console.log("Operational Area Updated")}).catch(function(e){s.reject(e)})},r.updateMass=function(n,r,t){var s=a.defer();e.put("/secure-api/operational_area/update_operational_region",n,r).then(function(e){console.log("Operational Area Updated")}).catch(function(e){s.reject(e)})},r.deleteOperationalArea=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("Operational Area Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("regionSvc",["$http","$q","$state",function(e,a,n){var r=this,t=[];r.getRegion=function(r,s){var i=a.defer();return e.get("/secure-api/region/get_region",r).then(function(e){t=e.data.data;for(var a in t)t[a].region=undoCleanEntry(t[a].region);i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.sumbitRegion=function(r,t,s){var i=a.defer();e.post("/secure-api/region/insert_region",r,t).then(function(e){console.log("Region Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateRegion=function(n,r,t){var s=a.defer();e.put("/secure-api/region/update_region",n,r).then(function(e){console.log("Region Updated")}).catch(function(e){s.reject(e)})},r.deleteRegion=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("Region Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("statesSvc",["$http","$q","$state",function(e,a,n){var r=this,t=[];r.getStates=function(r,s){var i=a.defer();return e.get("/secure-api/states/get_state",r).then(function(e){t=e.data.data,i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.sumbitStates=function(r,t,s){var i=a.defer();e.post("/secure-api/states/insert_state",r,t).then(function(e){console.log("State Submitted"),n.reload()}).catch(function(e){i.reject(e)})},r.updateStates=function(n,r,t){var s=a.defer();e.put("/secure-api/states/update_state",n,r).then(function(e){console.log("State Updated")}).catch(function(e){s.reject(e)})},r.deleteStates=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("State Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})}}])}(window,window.angular),function(e,a,n){a.module("app").service("userSvc",["$http","$q","$state",function(e,a,n){var r=this,t=[],s=[];r.getUsers=function(r,s){var i=a.defer();return e.get("/secure-api/user/get_users",r).then(function(e){t=e.data.data,i.resolve(t)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.getUnapprovedUsers=function(r,t){var i=a.defer();return e.get("/secure-api/user/get_unapproved_users",r).then(function(e){s=e.data.data,i.resolve(s)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.getProfile=function(r,t,s){var i=a.defer();return e.get("/secure-api/user/get_user?"+r,t).then(function(e){user=e.data.data[0],i.resolve(user)}).catch(function(e){i.reject(e),n.go("login")}),i.promise},r.passwordRequest=function(n,r){a.defer();e.post("api/user/password_request",n).then(function(e){console.log("Request Submitted")}).catch(function(e){console.log("Request Submitted")})},r.approveUser=function(r,t,s){var i=a.defer();e.post("/secure-api/user/approve_user",r,t).then(function(e){console.log("User Approved"),n.reload()}).catch(function(e){i.reject(e)})},r.submitUser=function(r,t,s){var i=a.defer();e.put("/secure-api/user/update_user",r,t).then(function(e){console.log("User Updated"),n.reload()}).catch(function(e){i.reject(e)})},r.updateProfile=function(r,t,s){var i=a.defer();e.put("/secure-api/user/update_profile",r,t).then(function(e){console.log("User Updated"),n.reload()}).catch(function(e){i.reject(e)})},r.updatePassword=function(r,t,s){var i=a.defer();e.put("/secure-api/user/change_password",r,t).then(function(e){console.log("User Updated"),n.reload()}).catch(function(e){i.reject(e)})},r.deleteUser=function(n,r,t){var s=a.defer();e.delete(n,r).then(function(e){console.log("User Removed"),s.resolve(e)}).catch(function(e){s.reject(e)})},r.token=void 0,r.user=void 0,r.role=void 0;var i,o=localStorage.getItem("token"),c=localStorage.getItem("user");'"Admin"'!==localStorage.getItem("role")&&'"Editor"'!==localStorage.getItem("role")||(i=localStorage.getItem("role")),o&&(r.token=JSON.parse(o),r.user=JSON.parse(c),'"Admin"'!==i&&'"Editor"'!==i||(r.role=JSON.parse(i))),date_parse=function(e){return e=e.toString(),e=moment.utc(e).add("12","hours").format(),e=moment.utc(e).toDate()},padding_right=function(e,a,n){if(!e||!a||e.length>=n)return e;for(var r=(n-e.length)/a.length,t=0;t<r;t++)e+=a;return e},padding_left=function(e,a,n){if(!e||!a||e.length>=n)return e;for(var r=(n-e.length)/a.length,t=0;t<r;t++)e=a+e;return e},cleanEntry=function(e){return e.replace(/~/g,"&tilde;").replace(/`/g,"&grave;").replace(/!/g,"&excl;").replace(/@/g,"&commat;").replace(/#/g,"&num;").replace(/\$/g,"&dollar;").replace(/%/g,"&percnt;").replace(/\^/g,"&Hat;").replace(/\*/g,"&ast;").replace(/\(/g,"&lpar;").replace(/\)/g,"&rpar;").replace(/-/g,"&hyphen;").replace(/_/g,"&lowbar;").replace(/\+/g,"&plus;").replace(/=/g,"&equals;").replace(/{/g,"&lbrace;").replace(/}/g,"&rbrace;").replace(/]/g,"&rbrack;").replace(/\[/g,"&lbrack;").replace(/:/g,"&colon;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/,/g,"&comma;").replace(/</g,"&lt;").replace(/\./g,"&period;").replace(/>/g,"&gt;").replace(/\?/g,"&quest;").replace(/\//g,"&sol;").replace(/\|/g,"&vert;")},undoCleanEntry=function(e){return e.replace(/&tilde;/g,"~").replace(/&grave;/g,"`").replace(/&excl;/g,"!").replace(/&commat;/g,"@").replace(/&num;/g,"#").replace(/&dollar;/g,"$").replace(/&percnt;/g,"%").replace(/&Hat;/g,"^").replace(/&ast;/g,"*").replace(/&lpar;/g,"(").replace(/&rpar;/g,")").replace(/&hyphen;/g,"-").replace(/&lowbar;/g,"_").replace(/&plus;/g,"+").replace(/&equals;/g,"=").replace(/&lbrace;/g,"{").replace(/&rbrace;/g,"}").replace(/&rbrack;/g,"]").replace(/&lbrack;/g,"[").replace(/&colon;/g,":").replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&comma;/g,",").replace(/&lt;/g,"<").replace(/&period;/g,".").replace(/&gt;/g,">").replace(/&quest;/g,"?").replace(/&sol;/g,"/").replace(/&vert;/g,"|")},sanatizePercent=function(e){var a=String(e);return-1==a.indexOf(".")?a>=1&&a<100?a/=100:a="."+a:a>1&&a<10?a/=100:a<1?(a="."+(a=a.replace(".","")),a*=10):a="."+(a=a.replace(".","")),a=parseFloat(a),Math.round(1e4*a)/1e4}}]).filter("dateRange",function(){return function(e,a,n,r){return e.filter(function(e){return!moment(e[a],"YYYY-MM-DD").isBefore(moment(n))&&!moment(e[a],"YYYY-MM-DD").isAfter(moment(r))})}})}(window,window.angular),function(e,a,n){a.module("app").controller("loginCtrl",["$scope","$state","userSvc","$http",function(a,n,r,t){a.logUserIn=function(e){t.post("/api/user/login",e).then(function(e){r.token=e.data.token,r.user=e.data.user.username,localStorage.setItem("token",JSON.stringify(r.token)),localStorage.setItem("user",JSON.stringify(r.user)),"Admin"!==e.data.user.role&&"Editor"!==e.data.user.role||(r.role=e.data.user.role,localStorage.setItem("role",JSON.stringify(r.role))),n.go("home")},function(e){if(console.error(e),Array.isArray(e.data)){$("#password_Error").empty(),$("#login_error").empty();for(var a=0;a<e.data.length;a++)$("#login_error").append('<p class="alert alert-danger">'+e.data[a]+"<p>")}else $("#password_Error").empty(),$("#login_error").empty(),$("#login_error").append('<p class="alert alert-danger">'+e.data+"<p>")})},a.passwordRecovery=function(){n.go("password_recovery")},a.sent=!1,a.forgotPassword=function(n){a.email=n.email,config={hello:"hi"},n={to:n.email,urlBase:e.location.origin},a.sent=!0,r.passwordRequest(n)}}])}(window,window.angular),function(e,a,n){a.module("app").controller("manageUserCtrl",["$scope","$state","$http","userSvc",function(e,a,n,r){var t={headers:{"auth-token":r.token}};e.roles=["User","Editor","Admin"],e.allUsers=[],e.allUnapprovedUsers=[],e.getEverything=function(a){r.getUsers(a).then(function(a){e.allUsers=a}),r.getUnapprovedUsers(a).then(function(a){e.allUnapprovedUsers=a})},e.getEverything(t),e.approveUser=function(e){e.login_attempts=0,e.last_login_attempt=Date.now(),console.log(e),r.approveUser(e,t)},e.submitUser=function(e){r.submitUser(e,t)},e.deleteUnapprovedUser=function(a){if(confirm("Are you sure you want to deny this User?")){request="/secure-api/user/delete_unapproved_user/?"+a,r.deleteUser(request,t);for(var n in e.allUnapprovedUsers)e.allUnapprovedUsers[n].unapproved_user_id===a&&e.allUnapprovedUsers.splice(n,1)}},e.deleteUser=function(a){if(confirm("Are you sure you want to delete this User?")&&a.username!=r.user){request="/secure-api/user/delete_user/?"+a.id,r.deleteUser(request,t);for(var n in e.allUsers)e.allUsers[n].id===a.id&&e.allUsers.splice(n,1)}else console.log("You cant delete yourself from this screen.")}}])}(window,window.angular),function(e,a,n){a.module("app").controller("profileCtrl",["$scope","$state","userSvc",function(e,a,n){var r={headers:{"auth-token":n.token}};e.user={},e.passLength=!1,e.special=!1,e.upperCase=!1,e.lowerCase=!1,e.number=!1,e.requirements=!1,e.passMatch=!1,e.errors=!1,e.errorsArry=[],e.getProfile=function(a,r){n.getProfile(a,r).then(function(a){e.user=a,e.user_id=e.user.id})},e.getProfile(n.user,r),e.submitProfile=function(e){n.updateProfile(e,r)},e.deleteProfile=function(a){confirm("Are you sure you want to delete your account? This CANNOT be undone.")&&e.user_id===a&&(request="/secure-api/user/delete_profile/?"+a,n.deleteUser(request,r),e.logout())},e.passCheck=function(a,n){var r=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/,t=/[A-Z]/,s=/[a-z]/,i=/\d/;a.length>13?e.passLength=!0:a.length<14&&(e.passLength=!1),r.test(a)?e.special=!0:e.special=!1,t.test(a)?e.upperCase=!0:e.upperCase=!1,s.test(a)?e.lowerCase=!0:e.lowerCase=!1,i.test(a)?e.number=!0:e.number=!1,e.passMatch=a===n,!0===e.passMatch&&!0===e.passLength&&!0===e.special&&!0===e.upperCase&&!0===e.lowerCase&&!0===e.number?e.requirements=!0:e.requirements=!1},e.changePassword=function(a){!0===e.requirements?n.updatePassword(a,r):(console.log("Passwords Requirments Not Met"),e.errors=!0,e.errorsArry=[],e.errorsArry.push("Passwords Requirments Not Met"))}}])}(window,window.angular),function(e,a,n){a.module("app").controller("registerCtrl",["$scope","$state","$http","userSvc",function(e,a,n,r){e.passLength=!1,e.special=!1,e.upperCase=!1,e.lowerCase=!1,e.number=!1,e.requirements=!1,e.passMatch=!1,e.formChange=function(a){var n=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/,r=/[A-Z]/,t=/[a-z]/,s=/\d/;a.user_password.length>13?e.passLength=!0:a.user_password.length<14&&(e.passLength=!1),n.test(a.user_password)?e.special=!0:e.special=!1,r.test(a.user_password)?e.upperCase=!0:e.upperCase=!1,t.test(a.user_password)?e.lowerCase=!0:e.lowerCase=!1,s.test(a.user_password)?e.number=!0:e.number=!1,a.user_password===a.password_check?e.passMatch=!0:e.passMatch=!1,!0===e.passMatch&&!0===e.passLength&&!0===e.special&&!0===e.upperCase&&!0===e.lowerCase&&!0===e.number?e.requirements=!0:e.requirements=!1},e.createUser=function(r){!0===e.requirements?($("#password_Error").empty(),$("#login_error").empty(),r.user_password===r.password_check?n.post("/api/user/create",r).then(function(e){$("#password_Error").empty(),$("#login_error").empty(),a.go("home")},function(e){if(console.error(e),Array.isArray(e.data)){$("#password_Error").empty(),$("#login_error").empty();for(var a=0;a<e.data.length;a++)$("#password_Error").append('<p class="alert alert-danger">'+e.data[a]+"<p>")}else $("#password_Error").empty(),$("#login_error").empty(),$("#password_Error").append('<p class="alert alert-danger">'+e.data+"<p>")}):($("#password_Error").empty(),$("#password_Error").append('<p class="alert alert-danger"> Passwords do not match, please make sure that they are the same <p>'))):($("#password_Error").empty(),$("#password_Error").append('<p class="alert alert-danger"> Please make sure you\'re password meets the requirements<p>'))}}])}(window,window.angular),function(e,a,n){a.module("app").controller("pswdCtrl",["$scope","$state","$http","$stateParams","userSvc",function(e,a,n,r,t){e.state=a.current,e.params=r,e.resetCode=e.params.resetCode,e.user_id=e.params.userID,e.passLength=!1,e.special=!1,e.upperCase=!1,e.lowerCase=!1,e.number=!1,e.requirements=!1,e.passMatch=!1,e.formChange=function(a){var n=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/,r=/[A-Z]/,t=/[a-z]/,s=/\d/;a.enter.length>13?e.passLength=!0:a.enter.length<14&&(e.passLength=!1),n.test(a.enter)?e.special=!0:e.special=!1,r.test(a.enter)?e.upperCase=!0:e.upperCase=!1,t.test(a.enter)?e.lowerCase=!0:e.lowerCase=!1,s.test(a.enter)?e.number=!0:e.number=!1,a.enter===a.check?e.passMatch=!0:e.passMatch=!1,!0===e.passMatch&&!0===e.passLength&&!0===e.special&&!0===e.upperCase&&!0===e.lowerCase&&!0===e.number?e.requirements=!0:e.requirements=!1},e.submitPassword=function(r){!0===e.requirements?($("#message").empty(),void 0===r.check||void 0===r.enter?$("#message").append('<br><p class="alert alert-danger"> Please enter a password. </p>'):r.check!=r.enter?$("#message").append('<br><p class="alert alert-danger"> The entered passwords do not match. </p>'):r.check===r.enter&&(r.reset_code=e.resetCode,r.user_id=e.user_id,n.post("api/user/reset_password",r),a.go("login"))):$("#password_Error").append('<p class="alert alert-danger"> Please make sure you\'re password meets the requirements<p>')}}])}(window,window.angular);
=======
!function(a,b,c){b.module("app",["ui.router","ngSanitize","angular.filter"]).config(["$urlRouterProvider","$stateProvider",function(a,b){b.state("index",{templateUrl:"/src/index.html",controller:"indexCtrl"}).state("home",{url:"/",templateUrl:"/src/components/home/home.html",controller:"homeCtrl"}).state("login",{url:"/login",templateUrl:"/src/components/user/views/login.html",controller:"loginCtrl"}).state("password_recovery",{url:"/password_recovery",templateUrl:"/src/components/user/views/password_recovery.html",controller:"loginCtrl"}).state("reset_password",{url:"/reset_password/:userID/:resetCode",templateUrl:"/src/components/user/views/reset_password.html",controller:"pswdCtrl"}).state("register",{url:"/register",templateUrl:"/src/components/user/views/register.html",controller:"registerCtrl"}).state("manage_users",{url:"/manage_users",templateUrl:"src/components/user/views/manage_users.html",controller:"manageUserCtrl"}).state("profile",{url:"/profile:user",templateUrl:"/src/components/user/views/profile.html",controller:"profileCtrl"}).state("company",{url:"/company",templateUrl:"/src/components/company/company.html",controller:"companyCtrl"}).state("invoice_configuration",{url:"/invoice_configuration",templateUrl:"/src/components/invoice_configuration/invoice_config.html"}).state("iot",{url:"/invoice_configuration/iot",templateUrl:"/src/components/invoice_configuration/IOT/iot.html",controller:"iotCtrl"}).state("fuel_rates",{url:"/invoice_configuration/fuel_rates",templateUrl:"/src/components/invoice_configuration/fuel_rates/fuel_rates.html",controller:"fuelRatesCtrl"}).state("operational_area",{url:"/invoice_configuration/operational_area",templateUrl:"/src/components/invoice_configuration/operational_area/operational_area.html",controller:"operationalAreaCtrl"}).state("carriers",{url:"/invoice_configuration/carriers",templateUrl:"/src/components/invoice_configuration/carriers/carriers.html",controller:"carrierCtrl"}).state("accessorial_cost",{url:"/invoice_configuration/accessorial_cost",templateUrl:"/src/components/invoice_configuration/prebuilt_associated_costs/prebuilt_associated_costs.html",controller:"accessorialCtrl"}).state("fsc",{url:"/invoice_configuration/fsc",templateUrl:"/src/components/invoice_configuration/fuel_surcharge_rates/fuel_surcharge_rates.html",controller:"fscCtrl"}).state("benchmark_fsc",{url:"/invoice_configuration/benchmark_fsc",templateUrl:"/src/components/invoice_configuration/benchmark_fsc/benchmark_fsc.html",controller:"benchmarkFSCCtrl"}).state("state_region",{url:"/invoice_configuration/state_region",templateUrl:"src/components/invoice_configuration/state_regions/state_regions.html",controller:"stateRegionCtrl"}).state("list-invoice",{url:"/invoice",templateUrl:"/src/components/invoice/views/list-invoice.html",controller:"invoiceListCtrl"}).state("form-invoice",{url:"/invoice/form-invoice/:invoiceID",templateUrl:"/src/components/invoice/views/form-invoice.html",controller:"invoiceFormCtrl"}).state("view-invoice",{url:"/invoice/view-invoice/:invoiceID",templateUrl:"/src/components/invoice/views/view-invoice.html",controller:"invoiceViewCtrl"}).state("price-savings",{url:"/invoice/price-savings/:invoiceIDs/:xpoIDs",templateUrl:"/src/components/invoice/views/price-savings.html",controller:"priceSavingsCtrl"}).state("view-xpo-invoice",{url:"/invoice/view-xpo-invoice/:invoiceID",templateUrl:"/src/components/invoice/views/view-xpo-invoice.html",controller:"viewXPOInvoice"}).state("form-xpo-invoice",{url:"/invoice/form-xpo-invoice/:xpoID",templateUrl:"/src/components/invoice/views/form-invoice.html",controller:"invoiceFormCtrl"}),a.otherwise("/")}])}(window,window.angular),function(a,b,c){b.module("app").controller("companyCtrl",["$scope","$state","$http","userSvc","clientSvc",function(a,b,c,d,e){var f={headers:{"auth-token":d.token}};a.allCompanies=[],a.getClients=function(b){e.getClients(b).then(function(b){a.allCompanies=b})},a.getClients(f),a.submitCompany=function(a){a.hasOwnProperty("client_address_2")?a.client_address_2=cleanEntry(a.client_address_2):a.client_address_2="",a.hasOwnProperty("client_zip_4")||(a.client_zip_4=""),a.client_address_1=cleanEntry(a.client_address_1),a.client_city=cleanEntry(a.client_city),a.client_country=cleanEntry(a.client_country),a.client_name=cleanEntry(a.client_name),a.client_id?e.updateClients(a,f):e.sumbitClients(a,f)},a.deleteCompany=function(b){if(!0===confirm("Are you sure you want to delete this Client?")){request="/secure-api/company/company_delete/?"+b,e.deleteClients(request,f);for(var c in a.allCompanies)a.allCompanies[c].client_id===b&&a.allCompanies.splice(c,1)}}}])}(window,window.angular),function(a,b,c){b.module("app").controller("homeCtrl",["$scope","$state","$http","userSvc",function(a,b,c,d){a.allCompanies=[];d.token}])}(window,window.angular),function(a,b,c){b.module("app").controller("indexCtrl",["$scope","$state","$http","userSvc",function(a,b,c,d){a.approvedUser=function(){return"Editor"===d.role||"Admin"===d.role?(a.approved=!0,!0):(a.approved=!1,!1)},a.isLoggedin=function(){return!!d.token&&(a.username=d.user,!0)},a.isAdmin=function(){return"Admin"===d.role},a.logoutConfirm=function(){!0===confirm("Are you sure you want to log out?")&&a.logout()},a.logout=function(){d.token=null,d.user=null,d.role=null,a.username=null,localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("role"),b.go("login")}}])}(window,window.angular),function(a,b,c){b.module("app").controller("invoiceFormCtrl",["$scope","$state","$http","$stateParams","userSvc","accessSvc","carrierSvc","operationAreaSvc","fuelRateService","iotSvc","clientSvc","invoiceSvc",function(a,c,d,e,f,g,h,i,j,k,l,m){var n={headers:{"auth-token":f.token}};if(a.allInvoices=[],a.specificInvoice=[],a.allCompanies=[],a.incomingEdi=[],a.allFuelRates=[],a.allIOT=[],a.items=[],a.totalWeight=0,a.totalAccessorialCharges=0,a.invoice={},a.classOptions=[50,55,60,65,70,77.5,85,92.5,100,110,125,150,175,200,250,300,400,500],a.shippingClasses=[],a.accessorialCharges=[],a.totalBenchmarkCost=[],a.allOperations=[],a.rateString="",a.returnString="",a.state=c.current,a.params=e,a.errors=!1,a.errorsArry=[],a.newRow=!1,a.allAccessorialBenchmark=[],a.allCarriers=[],a.getEverything=function(b){g.getAccess(b).then(function(b){a.allAccessorialBenchmark=b}),h.getCarriers(b).then(function(b){a.allCarriers=b}),i.getOperationalArea(b).then(function(b){a.allOperations=b}),j.getFuelRate(b).then(function(b){a.allFuelRates=b}),k.getIOT(b).then(function(b){a.allIOT=b}),l.getClients(b).then(function(b){a.allCompanies=b})},a.getEverything(n),a.params.invoiceID)m.getSpecificInvoice(a.params.invoiceID,n).then(function(b){a.specificInvoice=b,a.invoice=b[0],a.items=b;for(var c in a.specificInvoice)a.shippingClasses.push({weight:a.specificInvoice[c].weight,classification:a.specificInvoice[c].classification,rate:a.specificInvoice[c].rate,charge:a.specificInvoice[c].charge,invoice_number:a.specificInvoice[c].invoice_number,item_id:a.specificInvoice[c].item_id}),a.PD={};d.get("/secure-api/accessorial_cost_invoice/get_associated_costs_invoice?"+a.specificInvoice[0].invoice_number,n).then(function(b){a.associatedCosts=b.data.data;for(var c=0;c<a.associatedCosts.length;c++)a.accessorialCharges.push({actual_cost:parseFloat(a.associatedCosts[c].actual_cost),benchmark_cost:parseFloat(a.associatedCosts[c].benchmark_cost),cost_code:a.associatedCosts[c].cost_code,cost_id:a.associatedCosts[c].cost_id,invoice_number:a.associatedCosts[c].invoice_number}),a.PD={}},function(a){console.log(a)})});else if(a.params.xpoID)d.get("/secure-api/xpo/get_xpo_invoice?"+a.params.xpoID,n).then(function(b){a.xpoInvoice=b.data.data,a.xpoInvoice[0].old_cost=Math.round(100*parseFloat(a.xpoInvoice[0].old_cost))/100,a.xpoInvoice[0].old_fsc=Math.round(100*parseFloat(a.xpoInvoice[0].old_fsc))/100,a.xpoInvoice[0].old_total_cost=Math.round(100*parseFloat(a.xpoInvoice[0].old_total_cost))/100,a.xpoInvoice[0].new_cost=Math.round(100*parseFloat(a.xpoInvoice[0].new_cost))/100,a.xpoInvoice[0].new_fsc=Math.round(100*parseFloat(a.xpoInvoice[0].new_fsc))/100,a.xpoInvoice[0].new_total_cost=Math.round(100*parseFloat(a.xpoInvoice[0].new_total_cost))/100,a.xpoInvoice[0].discount_percent=sanatizePercent(a.xpoInvoice[0].discount_percent),a.xpoInvoice[0].savings=Math.round(100*parseFloat(a.xpoInvoice[0].savings))/100,a.xpoInvoice[0].base_charge=Math.round(100*parseFloat(a.xpoInvoice[0].base_charge))/100,a.xpoInvoice[0].ship_date=date_parse(a.xpoInvoice[0].ship_date),a.xpoInvoice[0].process_date=date_parse(a.xpoInvoice[0].process_date),a.xpoInvoice[0].discount_ammount=Math.round(100*parseFloat(a.xpoInvoice[0].discount_ammount))/100,console.log(a.xpoInvoice[0]),a.invoice=a.xpoInvoice[0]},function(a){console.log(a),c.go("login")});else{a.invoice={};var o=new Date,p=o.getDay();a.invoice.process_date=5===p?o:new Date(moment().day(5)),a.shippingClasses.push({}),a.PD={}}a.setOldCost=function(b){a.invoice.old_cost=b*(1-.829),a.invoice.discount_percent=sanatizePercent(a.invoice.discount_ammount/b),a.invoice.new_cost=b*(1-sanatizePercent(a.invoice.discount_percent)),a.invoice.old_fsc=a.invoice.old_cost*sanatizePercent(a.invoice.fsc_percent),a.invoice.new_fsc=a.invoice.new_cost*sanatizePercent(a.invoice.fsc_percent),a.invoice.old_total_cost=a.invoice.old_cost+a.invoice.old_fsc,a.invoice.new_total_cost=a.invoice.new_cost+a.invoice.new_fsc,a.invoice.savings=a.invoice.old_total_cost-a.invoice.new_total_cost},a.submitXPOInvoice=function(b){b.old_cost=Math.round(100*parseFloat(b.old_cost))/100,b.old_fsc=Math.round(100*parseFloat(b.old_fsc))/100,b.old_total_cost=Math.round(100*parseFloat(b.old_total_cost))/100,b.new_cost=Math.round(100*parseFloat(b.new_cost))/100,b.new_fsc=Math.round(100*parseFloat(b.new_fsc))/100,b.new_total_cost=Math.round(100*parseFloat(b.new_total_cost))/100,b.discount_percent=sanatizePercent(b.discount_percent),b.savings=Math.round(100*parseFloat(b.savings))/100,b.discount_ammount=Math.round(100*parseFloat(b.discount_ammount))/100,console.log(b);for(var e in a.allCompanies)a.allCompanies[e].client_id===b.client_id&&(b.client_name=a.allCompanies[e].client_name);b.accelerated_charge||(b.accelerated_charge=0),a.params.xpoID?d.put("/secure-api/xpo/update_xpo_invoice",b,n).then(function(a){console.log("Invoice Updated"),c.reload()},function(a){console.log(a)}):d.post("/secure-api/xpo/insert_xpo_invoice",b,n).then(function(a){console.log("New Invoice Added"),c.reload()},function(a){console.error(a)})},a.carrierCheck=function(){var b,c,d=a.invoice.sender_state,e=a.invoice.receiver_state,f=a.invoice.sender_zip,g=a.invoice.receiver_zip,h=a.invoice.carrier_id;for(var i in a.allCarriers)a.invoice.carrier_id===a.allCarriers[i].carrier_id&&(a.invoice.carrier_name=a.allCarriers[i].carrier_name);if(h&&d&&e){for(i in a.allOperations)if(a.allOperations[i].carrier_id===h&&a.allOperations[i].states===d){if(!a.allOperations[i].zip_code||""===a.allOperations[i].zip_code){b=a.allOperations[i];break}if(a.allOperations[i].zip_code===f){b=a.allOperations[i];break}}for(i in a.allOperations)if(a.allOperations[i].carrier_id===h&&a.allOperations[i].states===e){if(a.allOperations[i].zip_code===g){c=a.allOperations[i];break}if(!a.allOperations[i].zip_code||""===a.allOperations[i].zip_code){c=a.allOperations[i];break}}var j;j="IN"===b.states||"IN"===c.states?parseFloat(b.absolute_minimum_charge)>parseFloat(c.absolute_minimum_charge):parseFloat(b.absolute_minimum_charge)<parseFloat(c.absolute_minimum_charge),b&&c&&(j?(a.invoice.absolute_min_charge=parseFloat(b.absolute_minimum_charge),a.invoice.carrier_discount=parseFloat(b.discount),a.invoice.accelerated_charge=parseFloat(b.accelerated_charge)):(a.invoice.absolute_min_charge=parseFloat(c.absolute_minimum_charge),a.invoice.carrier_discount=parseFloat(c.discount),a.invoice.accelerated_charge=parseFloat(c.accelerated_charge)))}},a.submitInvoice=function(b,e,f){a.errors=!1,a.errorsArry=[];var g=!1,h=!1,i=!1,j=!1;for(var k in a.allOperations)if(a.allOperations[k].states===b.sender_state&&a.allOperations[k].carrier_id===b.carrier_id&&(g=!0),a.allOperations[k].states===b.receiver_state&&a.allOperations[k].carrier_id===b.carrier_id&&(h=!0),(a.allOperations[k].zip_code==b.sender_zip&&a.allOperations[k].carrier_id===b.carrier_id||(null===a.allOperations[k].zip_code||""===a.allOperations[k].zip_code)&&a.allOperations[k].carrier_id===b.carrier_id)&&(i=!0),(a.allOperations[k].zip_code==b.receiver_zip&&a.allOperations[k].carrier_id===b.carrier_id||(null===a.allOperations[k].zip_code||""===a.allOperations[k].zip_code)&&a.allOperations[k].carrier_id===b.carrier_id)&&(j=!0),g&&h&&i&&j)break;var l=!0;if(b.accelerated_charge||(b.accelerated_charge=0),g&&h&&i&&j||(l=confirm("The carrier you selected does not appear to deleive to the selected State and Zip Code combination, would you like to continue anyway?")),l)if(a.totalWeight=0,a.totalAccessorialCharges=0,a.totalBenchmarkCost=0,e!=[]&&0!==e.length){b.hasOwnProperty("sender_zip_4")||(b.sender_zip_4=""),b.hasOwnProperty("receiver_zip_4")||(b.receiver_zip_4=""),b.invoice_number=cleanEntry(b.invoice_number),b.sender_name=cleanEntry(b.sender_name),b.sender_address_1=cleanEntry(b.sender_address_1),b.sender_city=cleanEntry(b.sender_city),b.sender_country=cleanEntry(b.sender_country),b.receiver_name=cleanEntry(b.receiver_name),b.receiver_address_1=cleanEntry(b.receiver_address_1),b.receiver_city=cleanEntry(b.receiver_city),b.receiver_country=cleanEntry(b.receiver_country),b.transportation_mode=cleanEntry(b.transportation_mode),b.package_type=cleanEntry(b.package_type),b.receiver_zip_4=cleanEntry(b.receiver_zip_4),b.receiver_zip=cleanEntry(b.receiver_zip),b.sender_zip=cleanEntry(b.sender_zip),b.sender_zip_4=cleanEntry(b.sender_zip_4),b.carrier_discount=Math.round(100*sanatizePercent(b.carrier_discount))/100,b.accelerated_service||(b.accelerated_service=!1);for(k in e)e[k].invoice_number=b.invoice_number,a.totalWeight+=parseFloat(e[k].weight);b.billed_weight=a.totalWeight;for(k in f)f[k].invoice_number=b.invoice_number,a.totalAccessorialCharges+=parseFloat(f[k].actual_cost),a.totalBenchmarkCost+=f[k].benchmark_cost;f||(f=[]),b.total_associated_costs=a.totalAccessorialCharges,b.total_benchmark=a.totalBenchmarkCost,a.rateShipment(b,function(){""===a.params.invoiceID?d.post("/secure-api/invoice/insert_invoice",{invoice:b,shippedItems:e,accessorialCharges:f},n).then(function(a){console.log("New Invoice Added"),c.reload()},function(b){console.error(b);for(var c in b.data.errors)a.errors=!0,console.log(b.data.errors[c].message),a.errorsArry.push(b.data.errors[c].message)}):d.put("/secure-api/invoice/update_invoice",{invoice:b,shippedItems:e,accessorialCharges:f},n).then(function(a){console.log("Invoice Updated"),c.reload()},function(b){a.errors=!0,console.log(b);for(var c in b.data.errors)console.log(b.data.errors[c].message),a.errorsArry.push(b.data.errors[c].message)})})}else console.log("You must have atleast one item to submit this Invoice")},a.rateShipment=function(b,c){for(var e=b.sender_zip+" "+b.receiver_zip+" ",f=1e4*b.carrier_discount,g=0;g<10;g++)e+=f;b.absolute_min_charge<100?e=e+"0"+100*b.absolute_min_charge:e+=100*b.absolute_min_charge;var h=(Math.round(1e4*b.fuel_surcharge)/100).toString();for(h=padding_right(h," ",6),e=e+h+h,e+="      ",g=0;g<10;g++)if(a.shippingClasses[g]){var i=a.shippingClasses[g].classification.toString();i.length<4&&(i=padding_right(i," ",4));var j=a.shippingClasses[g].weight.toString();j.length<6&&(j=padding_left(j,"0",6)),e+=i,e+=padding_right(j," ",19)}e=padding_right(e," ",405),e+="MARS 500       20010806",e=padding_right(e," ",500);var k={rateString:e};d.put("/secure-api/invoice/test_tcp",k,n).then(function(d){var e=d.data;for(a.returnString=e.replace(/ /g,"&nbsp;"),g=0;g<10;g++){var f=85,h=91,i=91,j=98,k=23*g;a.shippingClasses[g]&&(f+=k,h+=k,i+=k,j+=k,rate=e.slice(f,h),rate=[rate.slice(0,-2),".",rate.slice(-2)].join(""),a.shippingClasses[g].rate=parseFloat(rate),charge=e.slice(i,j),charge=[charge.slice(0,-2),".",charge.slice(-2)].join(""),a.shippingClasses[g].charge=parseFloat(charge))}var l=e.slice(318,326);l=[l.slice(0,-2),".",l.slice(-2)].join(""),a.invoice.rated_sum=parseFloat(l),a.invoice.deficit_rate=parseFloat(e.slice(342,349))/100;var m=e.slice(396,404);m=[m.slice(0,-2),".",m.slice(-2)].join(""),a.invoice.rated_total_charge=parseFloat(m),c(b)},function(b){switch(console.log(b),a.errors=!0,b.data){case"01":console.log("This tariff is not available"),a.errorsArry.push("MARS Error 01: This tariff is not available");break;case"02":console.log("Rates are not available for this date"),a.errorsArry.push("MARS Error 02: Rates are not available for this date");break;case"03":console.log("The origin ZIP Code was not found in this tariff"),a.errorsArry.push("MARS Error 03: The origin ZIP Code was not found in this tariff");break;case"04":console.log("The destination ZIP Code was not found in this tariff"),a.errorsArry.push("MARS Error 04: The destination ZIP Code was not found in this tariff");break;case"05":console.log("A rate base number was not found for this pair of ZIP Codes"),a.errorsArry.push("MARS Error 05: A rate base number was not found for this pair of ZIP Codes");break;case"06":console.log("Tariff data is missing or corrupt"),a.errorsArry.push("MARS Error 06: Tariff data is missing or corrupt");break;case"99":console.log("Internal system error"),a.errorsArry.push("MARS Error 99: Internal system error");break;default:a.errorsArry.push("We have encountered an unknown MARS related error retreiving your shipment rating"),console.log("We have encountered an unknown MARS related error retreiving your shipment rating")}})},a.autoFillClient=function(b){for(var c in a.allCompanies)b===a.allCompanies[c].client_id&&(a.invoice.sender_name=a.allCompanies[c].client_name,a.invoice.sender_address_1=a.allCompanies[c].client_address_1,a.invoice.sender_address_2=a.allCompanies[c].client_address_2,a.invoice.sender_city=a.allCompanies[c].client_city,a.invoice.sender_zip=a.allCompanies[c].client_zip,a.invoice.sender_zip_4=a.allCompanies[c].client_zip_4,a.invoice.sender_country=a.allCompanies[c].client_country,a.invoice.sender_state=a.allCompanies[c].client_state,a.invoice.client_id=a.allCompanies[c].client_id,a.invoice.sender=a.allCompanies[c].client_name)},a.addRowItem=function(b){(b.length<10||void 0===b.length)&&(a.shippingClasses.push({weight:b.weight,classification:b.class,invoice_number:b.invoice_number}),a.PD={}),!1===a.newRow&&(a.newRow=!0)},a.addRowCharge=function(b){b||(b=[]),(b.length<12||void 0===b.length)&&(a.accessorialCharges.push({actual_cost:b.actual_cost,benchmark_cost:b.benchmark_cost,cost_code:b.cost_code,invoice_number:b.invoice_number}),a.PD={}),!1===a.newRow&&(a.newRow=!0)},a.remove=function(){var c=[],d=0;b.forEach(a.shippingClasses,function(a){a.selected||c.push(a)}),a.shippingClasses=c;for(var e in a.shippingClasses)a.shippingClasses[e].item_id||d++;var f=[];b.forEach(a.accessorialCharges,function(a){a.selected||f.push(a)}),a.accessorialCharges=f;for(e in a.accessorialCharges)a.accessorialCharges[e].cost_id||d++;a.shippingClasses.length<1&&a.addRowItem(a.shippingClasses),d<1&&(a.newRow=!1)},a.fuelChange=function(b){for(var c in a.allFuelRates)if(a.allFuelRates[c].fuel_rate_id===b){a.invoice.fuel_rate_id=a.allFuelRates[c].fuel_rate_id,a.invoice.fuel_date=a.allFuelRates[c].fuel_date,a.invoice.fuel_rate=a.allFuelRates[c].fuel_rate,a.invoice.fuel_surcharge=a.allFuelRates[c].fuel_surcharge;break}},a.autoFuelSurcharge=function(b){a.invoice.wrongDate=!1;var c,d=b.getDay(),e=moment(b);c=0===d||1===d||2===d?moment(e).day(-6):moment(e).day(1),e=new Date(c._d).toISOString().slice(0,10);for(var f in a.allFuelRates)if(a.allFuelRates[f].fuel_date=new Date(a.allFuelRates[f].fuel_date).toISOString().slice(0,10),a.allFuelRates[f].fuel_date===e){a.invoice.fuel_rate_id=a.allFuelRates[f].fuel_rate_id,a.invoice.fuel_date=a.allFuelRates[f].fuel_date,a.invoice.fuel_rate=a.allFuelRates[f].fuel_rate,a.invoice.fuel_surcharge=a.allFuelRates[f].fuel_surcharge;break}},a.deleteAccessorialCharge=function(b){var e=confirm("Are you sure you want to delete this Charge?");a.totalAccessorialCharges=0,a.totalBenchmarkCost=0;for(var f in a.accessorialCharges)a.totalAccessorialCharges+=a.accessorialCharges[f].actual_cost,a.totalBenchmarkCost+=a.accessorialCharges[f].benchmark_cost;a.totalAccessorialCharges-=b.actual_cost,a.totalBenchmarkCost-=b.benchmark_cost,!0===e&&(request="/secure-api/accessorial_cost_invoice/delete_associated_costs_invoice?"+b.cost_id+"/"+a.totalAccessorialCharges+"&"+a.totalBenchmarkCost+"|"+b.invoice_number,d.delete(request,n).then(function(a){c.reload(),console.log("Charge Removed")},function(a){console.log(a)}))},a.deleteShippingClass=function(b){var e=confirm("Are you sure you want to delete this Item?");a.totalWeight=0;for(var f in a.shippingClasses)a.totalWeight+=a.shippingClasses[f].weight;a.totalWeight-=b.weight,!0===e&&(request="/secure-api/shipping_class_invoice/delete_shipping_class_invoice?"+b.item_id+"/"+a.totalWeight+"|"+b.invoice_number,d.delete(request,n).then(function(a){c.reload(),console.log("Item Removed")},function(a){console.log(a)}))},a.changeCharge=function(b,c){for(var d in a.allAccessorialBenchmark)if(a.allAccessorialBenchmark[d].prebuilt_cost_id===c.prebuilt_cost_id){a.accessorialCharges[b].benchmark_cost=parseFloat(a.allAccessorialBenchmark[d].benchmark_cost),a.accessorialCharges[b].cost_code=a.allAccessorialBenchmark[d].cost_code;break}}}])}(window,window.angular),function(a,b,c){b.module("app").controller("invoiceListCtrl",["$scope","$state","$http","$stateParams","userSvc",function(a,c,d,e,f){var g={headers:{"auth-token":f.token}};a.allInvoices=[],a.to=new Date(moment().day(6)),a.from=new Date(moment().day(1)),a.selectAll=!1,a.errors=!1,a.errorsArry=[],a.exportToSavings=function(b,d){var e=[],f=[];for(var g in b)b[g].selected&&e.push(b[g].invoice_id);for(g in d)d[g].selected&&f.push(d[g].xpo_id);e.length+f.length>0?c.go("price-savings",{invoiceIDs:e,xpoIDs:f}):(console.log("Please select at least 1 invoice."),a.errors=!0,a.errorsArry=[],a.errorsArry.push("Please select at least 1 invoice."))},a.selectedAll=function(){a.selectAll?a.selectAll=!1:a.selectAll=!0,b.forEach(a.allInvoices,function(b){b.selected=a.selectAll}),b.forEach(a.allXPOInvoices,function(b){b.selected=a.selectAll})},a.AMCcheck=!1,a.grossCheck=!1,a.deficitCheck=!1,a.color="",a.rateCheck=function(a){var b="0"!==a.rated_sum&&0!==a.rated_sum,c=a.gross_charge!==a.rated_sum,d=a.deficit!==a.deficit_rate,e="";return(c||d)&&b&&(e="lightsalmon"),e},d.get("/secure-api/invoice/get_invoices_once",g).then(function(b){a.allInvoices=b.data.data;for(var c in a.allInvoices)a.allInvoices[c].process_date=date_parse(a.allInvoices[c].process_date),a.allInvoices[c].ship_date=date_parse(a.allInvoices[c].ship_date),a.allInvoices[c].delivery_date=date_parse(a.allInvoices[c].delivery_date),a.allInvoices[c].invoice_number=undoCleanEntry(a.allInvoices[c].invoice_number),a.allInvoices[c].sender_name=undoCleanEntry(a.allInvoices[c].sender_name),a.allInvoices[c].sender_address_1=undoCleanEntry(a.allInvoices[c].sender_address_1),a.allInvoices[c].sender_city=undoCleanEntry(a.allInvoices[c].sender_city),a.allInvoices[c].sender_country=undoCleanEntry(a.allInvoices[c].sender_country),a.allInvoices[c].receiver_name=undoCleanEntry(a.allInvoices[c].receiver_name),a.allInvoices[c].receiver_address_1=undoCleanEntry(a.allInvoices[c].receiver_address_1),a.allInvoices[c].receiver_city=undoCleanEntry(a.allInvoices[c].receiver_city),a.allInvoices[c].receiver_country=undoCleanEntry(a.allInvoices[c].receiver_country),a.allInvoices[c].transportation_mode=undoCleanEntry(a.allInvoices[c].transportation_mode),a.allInvoices[c].package_type=undoCleanEntry(a.allInvoices[c].package_type),a.allInvoices[c].receiver_zip_4=undoCleanEntry(a.allInvoices[c].receiver_zip_4),a.allInvoices[c].receiver_zip=undoCleanEntry(a.allInvoices[c].receiver_zip),a.allInvoices[c].sender_zip=undoCleanEntry(a.allInvoices[c].sender_zip),a.allInvoices[c].sender_zip_4=undoCleanEntry(a.allInvoices[c].sender_zip_4),a.allInvoices[c].carrier_name=undoCleanEntry(a.allInvoices[c].carrier_name)},function(a){console.log(a),c.go("login")}),d.get("/secure-api/xpo/get_XPO_invoices_once",g).then(function(b){a.allXPOInvoices=b.data.data;for(var c in a.allXPOInvoices)a.allXPOInvoices[c].invoice_number=a.allXPOInvoices[c].pro_number,a.allXPOInvoices[c].ship_date=date_parse(a.allXPOInvoices[c].ship_date),a.allXPOInvoices[c].process_date=date_parse(a.allXPOInvoices[c].process_date)},function(a){console.log(a),c.go("login")})}])}(window,window.angular),function(a,b,c){b.module("app").controller("priceSavingsCtrl",["$scope","$state","$http","$stateParams","userSvc",function(a,b,c,d,e){var f={headers:{"auth-token":e.token}};a.exportData=function(){setTimeout(function(){var b=new Blob([document.getElementById("savings_report").innerHTML],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),c=new Blob([document.getElementById("xpo_data").innerHTML],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),d=new Blob([document.getElementById("all_data").innerHTML],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"});saveAs(b,"Savings-Report-"+a.client_name+"-"+moment().format("YYYY/DD/MM")+".xls"),saveAs(c,"XPO-Data-"+a.client_name+"-"+moment().format("YYYY/DD/MM")+".xls"),saveAs(d,"All-Data-"+a.client_name+"-"+moment().format("YYYY/DD/MM")+".xls")},500)},a.savingsInvoices=[],a.associatedCosts=[],a.totalBenchmarkFrieghtCharge=0,a.totalBenchmarkCharge=0,a.totalBenchmarkAccessorial=0,a.totalFuelBenchmark=0,a.totalCharged=0,a.totalAccesorialCharge=0,a.totalFreightCharge=0,a.totalFuelCharge=0,a.state=b.current,a.params=d,a.recalculation=function(b,c){a.totalFuelBenchmark=0,a.totalBenchmarkAccessorial=0,a.totalBenchmarkFrieghtCharge=0,a.totalBenchmarkCharge=0,a.totalAccesorialCharge=0,a.totalCharged=0,a.totalFreightCharge=0,a.totalFuelCharge=0;for(var d in a.savingsInvoices)a.savingsInvoices[d].invoice_id===b.invoice_id&&(a.savingsInvoices[d]=b,"simple"===c?(a.savingsInvoices[d].total_benchmark!==b.benchamrk_access&&null!==a.savingsInvoices[d].benchamrk_access&&(a.savingsInvoices[d].benchmark_charge+=parseFloat(b.benchamrk_access)-parseFloat(a.savingsInvoices[d].total_benchmark),a.savingsInvoices[d].total_benchmark=b.benchamrk_access),a.savingsInvoices[d].assess_charge!==b.total_associated_costs&&null!==a.savingsInvoices[d].assess_charge&&(a.savingsInvoices[d].savings_total_charge+=parseFloat(b.assess_charge)-parseFloat(a.savingsInvoices[d].total_associated_costs),a.savingsInvoices[d].total_associated_costs=b.assess_charge)):"complex"===c&&(a.savingsInvoices[d].benchmark_fuel_charge=b.freight_charge*(b.benchmark_fuel_surcharge/100)*b.fsc_factor/100,a.savingsInvoices[d].benchmark_charge=Math.round(100*(a.savingsInvoices[d].benchmark_fuel_charge+a.savingsInvoices[d].freight_charge+a.savingsInvoices[d].total_benchmark))/100,a.savingsInvoices[d].savings_fuel_surcharge=b.savings_frieght_charge*(b.fuel_surcharge/100),a.savingsInvoices[d].savings_total_charge=Math.round(100*(a.savingsInvoices[d].savings_fuel_surcharge+a.savingsInvoices[d].savings_frieght_charge+a.savingsInvoices[d].assess_charge))/100)),a.totalFuelBenchmark+=a.savingsInvoices[d].benchmark_fuel_charge,a.totalBenchmarkAccessorial+=parseFloat(a.savingsInvoices[d].total_benchmark),a.totalBenchmarkFrieghtCharge+=a.savingsInvoices[d].freight_charge,a.totalBenchmarkCharge+=a.savingsInvoices[d].benchmark_charge,a.totalAccesorialCharge+=parseFloat(a.savingsInvoices[d].total_associated_costs),a.totalCharged+=a.savingsInvoices[d].savings_total_charge,a.totalFreightCharge+=a.savingsInvoices[d].savings_frieght_charge,a.totalFuelCharge+=parseFloat(a.savingsInvoices[d].savings_fuel_surcharge);for(d in a.savingsXPOInvoices)a.totalBenchmarkFrieghtCharge+=parseFloat(a.savingsXPOInvoices[d].old_cost),a.totalFuelBenchmark+=parseFloat(a.savingsXPOInvoices[d].old_fsc),a.totalBenchmarkCharge+=parseFloat(a.savingsXPOInvoices[d].old_total_cost),a.totalFreightCharge+=parseFloat(a.savingsXPOInvoices[d].new_cost),a.totalFuelCharge+=parseFloat(a.savingsXPOInvoices[d].new_fsc),a.totalCharged+=parseFloat(a.savingsXPOInvoices[d].new_total_cost)},a.calculation=function(){a.totalFuelBenchmark=0,a.totalBenchmarkAccessorial=0,a.totalBenchmarkFrieghtCharge=0,a.totalBenchmarkCharge=0,a.totalAccesorialCharge=0,a.totalCharged=0,a.totalFreightCharge=0,a.totalFuelCharge=0;for(var b=0;b<a.savingsInvoices.length;b++){console.log(a.savingsInvoices[b]),a.savingsInvoices[b].process_date=new Date(a.savingsInvoices[b].process_date),a.savingsInvoices[b].ship_date=new Date(a.savingsInvoices[b].ship_date),a.savingsInvoices[b].delivery_date=new Date(a.savingsInvoices[b].delivery_date),a.savingsInvoices[b].carrier_discount=Math.round(100*a.savingsInvoices[b].carrier_discount),a.savingsInvoices[b].discount=Math.round(1e4*a.savingsInvoices[b].discount)/100,a.savingsInvoices[b].gross_charge=parseFloat(a.savingsInvoices[b].gross_charge),a.savingsInvoices[b].absolute_min_charge=parseFloat(a.savingsInvoices[b].absolute_min_charge),a.savingsInvoices[b].fsc_factor=Math.round(1e4*a.savingsInvoices[b].fsc_factor)/100,a.savingsInvoices[b].bmfsc_factor=a.savingsInvoices[b].fsc_factor+"%",a.savingsInvoices[b].fuel_surcharge=Math.round(1e4*a.savingsInvoices[b].fuel_surcharge)/100,a.savingsInvoices[b].benchmark_fuel_surcharge=Math.round(1e4*a.savingsInvoices[b].benchmark_fuel_surcharge)/100,a.savingsInvoices[b].bfsc_percent=a.savingsInvoices[b].benchmark_fuel_surcharge+"%",a.savingsInvoices[b].accelerated_charge=parseFloat(a.savingsInvoices[b].accelerated_charge),a.savingsInvoices[b].deficit=parseFloat(a.savingsInvoices[b].deficit),a.savingsInvoices[b].rated_sum=parseFloat(a.savingsInvoices[b].rated_sum),a.savingsInvoices[b].deficit_rate=parseFloat(a.savingsInvoices[b].deficit_rate),a.savingsInvoices[b].benchamrk_access=parseFloat(a.savingsInvoices[b].benchamrk_access),a.savingsInvoices[b].assess_charge=parseFloat(a.savingsInvoices[b].assess_charge);var c=0,d=0;5===a.savingsInvoices[b].carrier_id?(c=a.savingsInvoices[b].rated_sum,d=a.savingsInvoices[b].deficit_rate):(c=a.savingsInvoices[b].gross_charge,d=a.savingsInvoices[b].deficit),(c+d)*(100-a.savingsInvoices[b].discount)/100<=88.39?(a.savingsInvoices[b].freight_charge=88.39,a.savingsInvoices[b].bmdiscount="AMC"):(a.savingsInvoices[b].bmdiscount=a.savingsInvoices[b].discount+"%",a.savingsInvoices[b].freight_charge=Math.round((c+d)*(100-a.savingsInvoices[b].discount))/100),(a.savingsInvoices[b].gross_charge+a.savingsInvoices[b].deficit_rate)*(100-a.savingsInvoices[b].carrier_discount)/100<=a.savingsInvoices[b].absolute_min_charge?(a.savingsInvoices[b].savings_discount="AMC",a.savingsInvoices[b].savings_frieght_charge=a.savingsInvoices[b].absolute_min_charge):(a.savingsInvoices[b].savings_discount=a.savingsInvoices[b].carrier_discount+"%",a.savingsInvoices[b].savings_frieght_charge=Math.round((a.savingsInvoices[b].gross_charge+a.savingsInvoices[b].deficit)*(100-a.savingsInvoices[b].carrier_discount))/100),!0===a.savingsInvoices[b].accelerated_service?(a.savingsInvoices[b].savings_accelerated_charge=Math.round(a.savingsInvoices[b].savings_frieght_charge*a.savingsInvoices[b].accelerated_charge*100)/100,a.savingsInvoices[b].benchmark_accelerated_charge=Math.round(a.savingsInvoices[b].freight_charge*a.savingsInvoices[b].accelerated_charge*100)/100,a.savingsInvoices[b].savings_accelerated_charge<30&&(a.savingsInvoices[b].savings_accelerated_charge=30,a.savingsInvoices[b].benchmark_accelerated_charge<a.savingsInvoices[b].savings_accelerated_charge&&(a.savingsInvoices[b].benchmark_accelerated_charge=a.savingsInvoices[b].savings_accelerated_charge)),a.savingsInvoices[b].total_associated_costs=parseFloat(a.savingsInvoices[b].total_associated_costs)+a.savingsInvoices[b].savings_accelerated_charge,
a.savingsInvoices[b].total_benchmark=parseFloat(a.savingsInvoices[b].total_benchmark)+a.savingsInvoices[b].savings_accelerated_charge):(a.savingsInvoices[b].savings_accelerated_charge=0,a.savingsInvoices[b].benchmark_accelerated_charge=0,a.savingsInvoices[b].total_associated_costs=parseFloat(a.savingsInvoices[b].total_associated_costs),a.savingsInvoices[b].total_benchmark=parseFloat(a.savingsInvoices[b].total_benchmark));var e=0;e=a.savingsInvoices[b].freight_charge,e=a.savingsInvoices[b].freight_charge+a.savingsInvoices[b].savings_accelerated_charge,a.savingsInvoices[b].savings_fuel_surcharge=Math.round((a.savingsInvoices[b].savings_frieght_charge+a.savingsInvoices[b].savings_accelerated_charge)*(a.savingsInvoices[b].fuel_surcharge/100)*100)/100,a.savingsInvoices[b].benchmark_fuel_charge=Math.round(a.savingsInvoices[b].benchmark_fuel_surcharge/100*a.savingsInvoices[b].fsc_factor/100*e*100)/100,a.savingsInvoices[b].savings_total_charge=Math.round(100*(parseFloat(a.savingsInvoices[b].savings_frieght_charge)+parseFloat(a.savingsInvoices[b].savings_fuel_surcharge)+parseFloat(a.savingsInvoices[b].total_associated_costs)))/100,a.savingsInvoices[b].benchmark_charge=a.savingsInvoices[b].benchmark_fuel_charge+a.savingsInvoices[b].freight_charge+a.savingsInvoices[b].total_benchmark,a.totalFuelBenchmark+=a.savingsInvoices[b].benchmark_fuel_charge,a.totalBenchmarkAccessorial+=parseFloat(a.savingsInvoices[b].total_benchmark),a.totalBenchmarkFrieghtCharge+=a.savingsInvoices[b].freight_charge,a.totalBenchmarkCharge+=a.savingsInvoices[b].benchmark_charge,a.totalAccesorialCharge+=parseFloat(a.savingsInvoices[b].total_associated_costs),a.totalCharged+=a.savingsInvoices[b].savings_total_charge,a.totalFreightCharge+=a.savingsInvoices[b].savings_frieght_charge,a.totalFuelCharge+=parseFloat(a.savingsInvoices[b].savings_fuel_surcharge)}for(b in a.savingsXPOInvoices)a.totalBenchmarkFrieghtCharge+=parseFloat(a.savingsXPOInvoices[b].old_cost),a.totalFuelBenchmark+=parseFloat(a.savingsXPOInvoices[b].old_fsc),a.totalBenchmarkCharge+=parseFloat(a.savingsXPOInvoices[b].old_total_cost),a.totalFreightCharge+=parseFloat(a.savingsXPOInvoices[b].new_cost),a.totalFuelCharge+=parseFloat(a.savingsXPOInvoices[b].new_fsc),a.totalCharged+=parseFloat(a.savingsXPOInvoices[b].new_total_cost)},a.params.invoiceIDs?c.get("/secure-api/invoice/get_invoices_price_savings?"+a.params.invoiceIDs,f).then(function(b){a.savingsInvoices=b.data.data;for(var d in a.savingsInvoices)a.savingsInvoices[d].carrier_name=undoCleanEntry(a.savingsInvoices[d].carrier_name),a.savingsInvoices[d].invoice_number=undoCleanEntry(a.savingsInvoices[d].invoice_number),a.savingsInvoices[d].receiver_name=undoCleanEntry(a.savingsInvoices[d].receiver_name),a.savingsInvoices[d].receiver_zip=undoCleanEntry(a.savingsInvoices[d].receiver_zip),a.savingsInvoices[d].process_date=date_parse(a.savingsInvoices[d].process_date),a.savingsInvoices[d].ship_date=date_parse(a.savingsInvoices[d].ship_date),a.savingsInvoices[d].delivery_date=date_parse(a.savingsInvoices[d].delivery_date),a.savingsInvoices[d].ACCSCosts=[],a.savingsInvoices[d].shipped_Item=[];a.process_date=a.savingsInvoices[0].process_date,a.client_name=a.savingsInvoices[0].client_name,a.params.xpoIDs?c.get("/secure-api/xpo/get_xpo_invoices_price_savings?"+a.params.xpoIDs,f).then(function(b){a.savingsXPOInvoices=b.data.data;for(d in a.savingsXPOInvoices)a.savingsXPOInvoices[d].ship_date=date_parse(a.savingsXPOInvoices[d].ship_date),a.savingsXPOInvoices[d].process_date=date_parse(a.savingsXPOInvoices[d].process_date),a.savingsXPOInvoices[d].invoice_number=a.savingsXPOInvoices[d].pro_number,a.savingsXPOInvoices[d].discount_percent=Math.round(1e4*a.savingsXPOInvoices[d].discount_percent)/100;a.getAssoccClass(),a.calculation()},function(a){console.log(a)}):(a.getAssoccClass(),a.calculation())},function(a){console.log(a)}):c.get("/secure-api/xpo/get_xpo_invoices_price_savings?"+a.params.xpoIDs,f).then(function(b){a.savingsXPOInvoices=b.data.data,console.log(b.data.data);for(var c in a.savingsXPOInvoices)a.savingsXPOInvoices[c].ship_date=date_parse(a.savingsXPOInvoices[c].ship_date),a.savingsXPOInvoices[c].process_date=date_parse(a.savingsXPOInvoices[c].process_date),a.savingsXPOInvoices[c].invoice_number=a.savingsXPOInvoices[c].pro_number,a.savingsXPOInvoices[c].discount_percent=Math.round(1e4*a.savingsXPOInvoices[c].discount_percent)/100;a.process_date=a.savingsXPOInvoices[0].process_date,a.client_name=a.savingsXPOInvoices[0].client_name,a.calculation()},function(a){console.log(a)}),a.getAssoccClass=function(){c.get("/secure-api/accessorial_cost_invoice/get_associated_costs_invoices",f).then(function(b){a.ACCSCosts=b.data.data;for(var c in a.ACCSCosts){a.ACCSCosts[c].invoice_number=undoCleanEntry(a.ACCSCosts[c].invoice_number);for(var d in a.savingsInvoices)a.ACCSCosts[c].invoice_number===a.savingsInvoices[d].invoice_number&&a.savingsInvoices[d].ACCSCosts.push(a.ACCSCosts[c])}},function(a){console.log(a)}),c.get("/secure-api/shipping_class_invoice/get_shipping_class_invoice",f).then(function(b){a.shipped_Item=b.data.data;for(var c in a.shipped_Item){a.shipped_Item[c].invoice_number=undoCleanEntry(a.shipped_Item[c].invoice_number);for(var d in a.savingsInvoices)a.shipped_Item[c].invoice_number===a.savingsInvoices[d].invoice_number&&a.savingsInvoices[d].shipped_Item.push(a.shipped_Item[c])}},function(a){console.log(a)}),console.log(a.savingsInvoices.length)}}])}(window,window.angular),function(a,b,c){b.module("app").controller("invoiceViewCtrl",["$scope","$state","$http","$stateParams","userSvc",function(a,b,c,d,e){var f={headers:{"auth-token":e.token}};a.specificInvoice=[],a.associatedCosts=[],a.state=b.current,a.params=d,c.get("/secure-api/invoice/get_invoice?"+a.params.invoiceID,f).then(function(b){a.specificInvoice=b.data.data;for(var d=0;d<a.specificInvoice.length;d++)a.specificInvoice[d].process_date=date_parse(a.specificInvoice[d].process_date),a.specificInvoice[d].ship_date=date_parse(a.specificInvoice[d].ship_date),a.specificInvoice[d].delivery_date=date_parse(a.specificInvoice[d].delivery_date),a.specificInvoice[d].carrier_discount=Math.round(100*a.specificInvoice[d].carrier_discount),a.specificInvoice[d].invoice_number=undoCleanEntry(a.specificInvoice[d].invoice_number),a.specificInvoice[d].sender_name=undoCleanEntry(a.specificInvoice[d].sender_name),a.specificInvoice[d].sender_address_1=undoCleanEntry(a.specificInvoice[d].sender_address_1),a.specificInvoice[d].sender_city=undoCleanEntry(a.specificInvoice[d].sender_city),a.specificInvoice[d].sender_country=undoCleanEntry(a.specificInvoice[d].sender_country),a.specificInvoice[d].receiver_name=undoCleanEntry(a.specificInvoice[d].receiver_name),a.specificInvoice[d].receiver_address_1=undoCleanEntry(a.specificInvoice[d].receiver_address_1),a.specificInvoice[d].receiver_city=undoCleanEntry(a.specificInvoice[d].receiver_city),a.specificInvoice[d].receiver_country=undoCleanEntry(a.specificInvoice[d].receiver_country),a.specificInvoice[d].transportation_mode=undoCleanEntry(a.specificInvoice[d].transportation_mode),a.specificInvoice[d].package_type=undoCleanEntry(a.specificInvoice[d].package_type),a.specificInvoice[d].receiver_zip_4=undoCleanEntry(a.specificInvoice[d].receiver_zip_4),a.specificInvoice[d].receiver_zip=undoCleanEntry(a.specificInvoice[d].receiver_zip),a.specificInvoice[d].sender_zip=undoCleanEntry(a.specificInvoice[d].sender_zip),a.specificInvoice[d].sender_zip_4=undoCleanEntry(a.specificInvoice[d].sender_zip_4);a.items=a.specificInvoice,c.get("/secure-api/accessorial_cost_invoice/get_associated_costs_invoice?"+a.specificInvoice[0].invoice_number,f).then(function(b){a.associatedCosts=b.data.data},function(a){console.log(a)})},function(a){console.log(a),b.go("login")}),a.deleteInvoice=function(a){!0===confirm("Are you sure you want to delete this Invoice?")&&(request="/secure-api/invoice/delete_invoice?"+a,c.delete(request,f).then(function(a){console.log("Invoice Removed"),b.go("list-invoice")},function(a){console.log(a),b.go("login")}))}}])}(window,window.angular),function(a,b,c){b.module("app").controller("viewXPOInvoice",["$scope","$state","$http","$stateParams","userSvc",function(a,b,c,d,e){var f={headers:{"auth-token":e.token}};a.state=b.current,a.params=d,a.xpoInvoice={},a.deleteXPOInvoice=function(a){!0===confirm("Are you sure you want to delete this Invoice?")&&(request="/secure-api/xpo/delete_xpo_invoice?"+a,c.delete(request,f).then(function(a){console.log("Invoice Removed"),b.go("list-invoice")},function(a){console.log(a),b.go("login")}))},c.get("/secure-api/xpo/get_xpo_invoice?"+a.params.invoiceID,f).then(function(b){a.xpoInvoice=b.data.data,a.xpoInvoice[0].ship_date=date_parse(a.xpoInvoice[0].ship_date),a.xpoInvoice[0].process_date=date_parse(a.xpoInvoice[0].process_date),a.xpoInvoice[0].discount_percent=sanatizePercent(a.xpoInvoice[0].discount_percent)},function(a){console.log(a),b.go("login")})}])}(window,window.angular),function(a,b,c){b.module("app").controller("iotCtrl",["$scope","$state","userSvc","iotSvc",function(a,b,c,d){var e={headers:{"auth-token":c.token}};a.allIOT=[],a.newIOT={},a.getEverything=function(b){d.getIOT(b).then(function(b){a.allIOT=b})},a.getEverything(e),a.submitIOT=function(b){b.delivery_type=cleanEntry(b.delivery_type),b.discount=sanatizePercent(b.discount),b.fsc_factor=sanatizePercent(b.fsc_factor),b.iot_id?d.updateIOT(b,e):(d.sumbitIOT(b,e),a.newIOT={})},a.deleteIOT=function(b){if(confirm("Are you sure you want to delete this IOT?")){request="/secure-api/iot/delete_iot/?"+b,d.deleteIOT(request,e);for(var c in a.allIOT)a.allIOT[c].iot_id===b&&a.allIOT.splice(c,1)}}}])}(window,window.angular),function(a,b,c){b.module("app").controller("benchmarkFSCCtrl",["$scope","$state","userSvc","benchmarkSvc",function(a,b,c,d){var e={headers:{"auth-token":c.token}};a.allBenchmarkFSC=[],a.getEverything=function(b){d.getBenchmark(b).then(function(b){a.allBenchmarkFSC=b})},a.getEverything(e),a.submitBenchmarkFSC=function(b){var c=!1;for(var f in a.allBenchmarkFSC)if(a.allBenchmarkFSC[f].fuel_index===b.fuel_index&&b.benchmark_fsc_id!==a.allBenchmarkFSC[f].benchmark_fsc_id){console.log("That rate is already covered please enter a diffrent rate"),c=!0;break}c||(b.benchmark_fuel_surcharge=sanatizePercent(b.benchmark_fuel_surcharge),b.benchmark_fsc_id?d.updateBenchmark(b,e):(d.sumbitBenchmark(b,e),a.newCarrier={}))},a.deleteBenchmarkFSC=function(b){if(confirm("Are you sure you want to delete this Benchmark?")){request="/secure-api/benchmark_fsc/delete_benchmark_fsc/?"+b,d.deleteBenchmark(request,e);for(var c in a.allBenchmarkFSC)a.allBenchmarkFSC[c].benchmark_fsc_id===b&&a.allBenchmarkFSC.splice(c,1)}}}])}(window,window.angular),function(a,b,c){b.module("app").controller("carrierCtrl",["$scope","$state","userSvc","carrierSvc",function(a,b,c,d){var e={headers:{"auth-token":c.token}};a.newCarrier={},a.allCarriers=[],a.getCarriers=function(b){d.getCarriers(b).then(function(b){a.allCarriers=b})},a.getCarriers(e),a.submitCarrier=function(b){b.carrier_name=cleanEntry(b.carrier_name),b.carrier_id?d.updateCarriers(b,e):(d.sumbitCarriers(b,e),a.newCarrier={})},a.deleteCarrier=function(b){if(confirm("Are you sure you want to delete this Carrier?")){request="/secure-api/carrier/delete_carrier/?"+b,d.deleteCarriers(request,e);for(var c in a.allCarriers)a.allCarriers[c].carrier_id===b&&a.allCarriers.splice(c,1)}}}])}(window,window.angular),function(a,b,c){b.module("app").controller("fuelRatesCtrl",["$scope","$state","userSvc","benchmarkSvc","fscsSvc","fuelRateService",function(a,b,c,d,e,f){var g={headers:{"auth-token":c.token}};a.allFuelRates=[],a.allFscs=[],a.limit=100,a.allBenchmarkFSC=[],a.getEverything=function(b){d.getBenchmark(b).then(function(b){a.allBenchmarkFSC=b}),e.getFscs(b).then(function(b){a.allFscs=b}),f.getFuelRate(b).then(function(b){a.allFuelRates=b})},a.getEverything(g),a.submitFuelRate=function(b){b.fuel_rate_rounded=Math.floor(100*b.fuel_rate);for(var c in a.allBenchmarkFSC)b.fuel_rate_rounded===a.allBenchmarkFSC[c].fuel_index&&(b.benchmark_fuel_surcharge=a.allBenchmarkFSC[c].benchmark_fuel_surcharge);if(b.benchmark_fuel_surcharge||(b.benchmark_fuel_surcharge=null),b.fuel_rate<2)b.fuel_surcharge=0;else for(var d in a.allFscs)a.allFscs[d].start_rate<=b.fuel_rate&&b.fuel_rate<=a.allFscs[d].end_rate&&(b.fuel_surcharge=a.allFscs[d].fuel_surcharge);b.fuel_rate_id?f.updateFuelRate(b,g):(f.sumbitFuelRate(b,g),a.newFSC={})},a.deleteFuelRate=function(b){if(confirm("Are you sure you want to delete this Fuel Rate?")){request="/secure-api/fuel_rates/delete_fuel_rate/?"+b,f.deleteFuelRate(request,g);for(var c in a.allFuelRates)a.allFuelRates[c].fuel_rate_id===b&&a.allFuelRates.splice(c,1)}},a.sortBy=function(b){a.reverse=null!==b&&a.propertyName===b&&!a.reverse,a.propertyName=b},a.increaseLimit=function(){a.limit+=100,console.log(a.limit)}}])}(window,window.angular),function(a,b,c){b.module("app").controller("fscCtrl",["$scope","$state","userSvc","fscsSvc",function(a,b,c,d){var e={headers:{"auth-token":c.token}};a.allFscs=[],a.newFSC={},a.getEverything=function(b){d.getFscs(b).then(function(b){a.allFscs=b})},a.getEverything(e),a.submitFSC=function(b){var c=!1;if(b.start_rate<b.end_rate){for(var f in a.allFscs)if(a.allFscs[f].start_rate<=b.start_rate&&a.allFscs[f].end_rate>=b.start_rate&&b.fuel_surcharge_id!==a.allFscs[f].fuel_surcharge_id){console.log("That rate is already covered please enter a diffrent rate"),c=!0;break}c||(b.fuel_surcharge=sanatizePercent(b.fuel_surcharge),b.fuel_surcharge_id?d.updateFscs(b,e):(d.sumbitFscs(b,e),a.newFSC={}))}else console.log("Starting Rate must be lower than ending rate")},a.deleteFSC=function(b){if(confirm("Are you sure you want to delete this Fuel Surcharge?")){request="/secure-api/fuel_surcharge_rates/delete_fsc/?"+b,d.deleteFscs(request,e);for(var c in a.allFscs)a.allFscs[c].fuel_surcharge_id===b&&a.allFscs.splice(c,1)}}}])}(window,window.angular),function(a,b,c){b.module("app").controller("operationalAreaCtrl",["$scope","$state","userSvc","carrierSvc","operationAreaSvc","regionSvc","statesSvc",function(a,b,c,d,e,f,g){var h={headers:{"auth-token":c.token}};a.limit=100,a.allCarriers=[],a.allOperations=[],a.allRegions=[],a.allStates=[],a.newOperationalArea={},a.getEverything=function(b){d.getCarriers(b).then(function(b){a.allCarriers=b}),e.getOperationalArea(b).then(function(b){a.allOperations=b}),f.getRegion(b).then(function(b){a.allRegions=b}),g.getStates(b).then(function(b){a.allStates=b})},a.getEverything(h),a.submitOperationalArea=function(b){for(var c in a.allStates)a.allStates[c].state_id===b.state_id&&(b.states=a.allStates[c].states);b.accelerated_charge||(b.accelerated_charge=0),void 0!==b.zip_code&&""!==b.zip_code&&null!==b.zip_code||(b.zip_code=""),b.zip_code=cleanEntry(b.zip_code),b.discount=sanatizePercent(b.discount),b.accelerated_charge=sanatizePercent(b.accelerated_charge),b.operation_id?e.updateOperationalArea(b,h):(e.sumbitOperationalArea(b,h),a.newOperationalArea={})},a.massUpdate=function(a){a.discount=sanatizePercent(a.discount),a.accelerated_charge=sanatizePercent(a.accelerated_charge),e.updateMass(a,h)},a.sortBy=function(b){a.reverse=null!==b&&a.propertyName===b&&!a.reverse,a.propertyName=b},a.update_list=function(b){a.selectedRegion=[];for(var c in a.allRegions)a.allRegions[c].state_id===b&&a.selectedRegion.push(a.allRegions[c])},a.increaseLimit=function(){a.limit+=100,console.log(a.limit)},a.deleteOperationalArea=function(b){if(confirm("Are you sure you want to delete this Operational Area?")){request="/secure-api/operational_area/delete_operational_area/?"+b,e.deleteOperationalArea(request,h);for(var c in a.allOperations)a.allOperations[c].operation_id===b&&a.allOperations.splice(c,1)}}}])}(window,window.angular),function(a,b,c){b.module("app").controller("accessorialCtrl",["$scope","$state","userSvc","accessSvc",function(a,b,c,d){var e={headers:{"auth-token":c.token}};a.newAccessorialCharge={},a.allAccessorial=[],a.getAccess=function(b){d.getAccess(b).then(function(b){a.allAccessorial=b})},a.getAccess(e),a.submitAccessorialCharge=function(b){b.description=cleanEntry(b.description),b.cost_code=cleanEntry(b.cost_code),b.prebuilt_cost_id?d.updateAccess(b,e):(d.sumbitAccess(b,e),a.newAccessorialCharge={})},a.deleteAccessorialCharge=function(b){if(confirm("Are you sure you want to delete this State?")){request="/secure-api/accessorial_cost/delete_prebuilt_associated_costs/?"+b,d.deleteAccess(request,e);for(var c in a.allAccessorial)a.allAccessorial[c].prebuilt_cost_id===b&&a.allAccessorial.splice(c,1)}}}])}(window,window.angular),function(a,b,c){b.module("app").controller("stateRegionCtrl",["$scope","$state","userSvc","regionSvc","statesSvc",function(a,b,c,d,e){var f={headers:{"auth-token":c.token}};a.allRegions=[],a.newRegion={},a.allStates=[],a.newState={},a.getEverything=function(b){d.getRegion(b).then(function(b){a.allRegions=b}),e.getStates(b).then(function(b){a.allStates=b})},a.getEverything(f),a.submitRegion=function(b){for(var c in a.allRegions)a.allRegions[c].state_id===b.state_id&&(b.states=a.allRegions[c].states);b.region=cleanEntry(b.region),b.state_region_id?d.updateRegion(b,f):(d.sumbitRegion(b,f),a.newRegion={})},a.submitState=function(b){b.states=cleanEntry(b.states),b.state_id?e.updateStates(b,f):(e.sumbitStates(b,f),a.newState={})},a.deleteRegion=function(b){if(confirm("Are you sure you want to delete this Region?")){request="/secure-api/region/delete_region/?"+b,d.deleteRegion(request,f);for(var c in a.allRegions)a.allRegions[c].state_region_id===b&&a.allRegions.splice(c,1)}},a.deleteState=function(b){if(confirm("Are you sure you want to delete this State?")){request="/secure-api/states/delete_state/?"+b,d.deleteRegion(request,f);for(var c in a.allStates)a.allStates[c].state_id===b&&a.allStates.splice(c,1)}}}])}(window,window.angular),function(a,b,c){b.module("app").service("accessSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getAccess=function(d,f){var g=b.defer();return a.get("/secure-api/accessorial_cost/get_prebuilt_associated_costs",d).then(function(a){e=a.data.data;for(var b in e)e[b].benchmark_cost=parseFloat(e[b].benchmark_cost),e[b].description=undoCleanEntry(e[b].description),e[b].cost_code=undoCleanEntry(e[b].cost_code);g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.sumbitAccess=function(d,e,f){var g=b.defer();a.post("/secure-api/accessorial_cost/insert_prebuilt_associated_costs",d,e).then(function(a){console.log("Prebuilt Accessorial Submitted"),c.reload()}).catch(function(a){g.reject(a)})},d.updateAccess=function(c,d,e){var f=b.defer();a.put("/secure-api/accessorial_cost/update_prebuilt_associated_costs",c,d).then(function(a){console.log("Prebuilt Accessorial Updated")}).catch(function(a){f.reject(a)})},d.deleteAccess=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("Prebuilt Accessorial Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})}}])}(window,window.angular),function(a,b,c){b.module("app").service("benchmarkSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getBenchmark=function(d,f){var g=b.defer();return a.get("/secure-api/benchmark_fsc/get_benchmark_fsc",d).then(function(a){e=a.data.data;for(var b in e)e[b].benchmark_fuel_surcharge_percent=Math.round(1e4*e[b].benchmark_fuel_surcharge)/100+"%",e[b].fuel_index=parseFloat(e[b].fuel_index),e[b].benchmark_fuel_surcharge=parseFloat(e[b].benchmark_fuel_surcharge);g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.sumbitBenchmark=function(d,e,f){var g=b.defer();a.post("/secure-api/benchmark_fsc/insert_benchmark_fsc",d,e).then(function(a){console.log("Fuel Surcharge Submitted"),c.reload()}).catch(function(a){g.reject(a)})},d.updateBenchmark=function(c,d,e){var f=b.defer();a.put("/secure-api/benchmark_fsc/update_benchmark_fsc",c,d).then(function(a){console.log("Fuel Surcharge Updated")}).catch(function(a){f.reject(a)})},d.deleteBenchmark=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("Benchmark FSC Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})}}])}(window,window.angular),function(a,b,c){b.module("app").service("carrierSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getCarriers=function(d,f){var g=b.defer();return a.get("/secure-api/carrier/get_carriers",d).then(function(a){e=a.data.data;for(var b in e)e[b].carrier_name=undoCleanEntry(e[b].carrier_name);g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.sumbitCarriers=function(d,e,f){var g=b.defer();a.post("/secure-api/carrier/insert_carriers",d,e).then(function(a){console.log("Fuel Surcharge Submitted"),c.reload()}).catch(function(a){g.reject(a)})},d.updateCarriers=function(c,d,e){var f=b.defer();a.put("/secure-api/carrier/update_carrier",c,d).then(function(a){console.log("Fuel Surcharge Updated")}).catch(function(a){f.reject(a)})},d.deleteCarriers=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("Fuel Surcharge Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})}}])}(window,window.angular),function(a,b,c){b.module("app").service("clientSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getClients=function(d,f){var g=b.defer();return a.get("/secure-api/company/get_companies",d).then(function(a){e=a.data.data;for(var b in e)e[b].client_address_1=undoCleanEntry(e[b].client_address_1),e[b].client_city=undoCleanEntry(e[b].client_city),e[b].client_name=undoCleanEntry(e[b].client_name),e[b].client_country=undoCleanEntry(e[b].client_country),e[b].client_address_2&&(e[b].client_address_2=undoCleanEntry(e[b].client_address_2));g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.sumbitClients=function(d,e,f){console.log("test");var g=b.defer();a.post("/secure-api/company/insert_company",d,e).then(function(a){console.log("Client Submitted"),c.reload()}).catch(function(a){g.reject(a)})},d.updateClients=function(c,d,e){console.log("test");var f=b.defer();a.put("/secure-api/company/update_company",c,d).then(function(a){console.log("Client Updated")}).catch(function(a){f.reject(a)})},d.deleteClients=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("Client Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})}}])}(window,window.angular),function(a,b,c){b.module("app").service("fscsSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getFscs=function(d,f){var g=b.defer();return a.get("/secure-api/fuel_surcharge_rates/get_fsc",d).then(function(a){e=a.data.data;for(var b in e)e[b].fuel_surcharge_percent=Math.round(1e4*e[b].fuel_surcharge)/100+"%",e[b].start_rate=parseFloat(e[b].start_rate),e[b].end_rate=parseFloat(e[b].end_rate),e[b].fuel_surcharge=parseFloat(e[b].fuel_surcharge);g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.sumbitFscs=function(d,e,f){var g=b.defer();a.post("/secure-api/fuel_surcharge_rates/insert_fsc",d,e).then(function(a){console.log("Fuel Surcharge Submitted"),c.reload()}).catch(function(a){g.reject(a)})},d.updateFscs=function(c,d,e){var f=b.defer();a.put("/secure-api/fuel_surcharge_rates/update_fsc",c,d).then(function(a){console.log("Fuel Surcharge Updated")}).catch(function(a){f.reject(a)})},d.deleteFscs=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("Fuel Surcharge Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})}}])}(window,window.angular),function(a,b,c){b.module("app").service("fuelRateService",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getFuelRate=function(d,f){var g=b.defer();return a.get("/secure-api/fuel_rates/get_fuel_rates",d).then(function(a){e=a.data.data;for(var b=0;b<e.length;b++)e[b].fuel_date=date_parse(e[b].fuel_date),e[b].fuel_date_display=moment(e[b].fuel_date).format("YYYY/MM/DD");g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.sumbitFuelRate=function(d,e,f){var g=b.defer();a.post("/secure-api/fuel_rates/insert_fuel_rate",d,e).then(function(a){console.log("Fuel Surcharge Submitted"),c.reload()}).catch(function(a){g.reject(a)})},d.updateFuelRate=function(c,d,e){var f=b.defer();a.put("/secure-api/fuel_rates/update_fuel_rate",c,d).then(function(a){console.log("Fuel Surcharge Updated")}).catch(function(a){f.reject(a)})},d.deleteFuelRate=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("Fuel Surcharge Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})}}])}(window,window.angular),function(a,b,c){b.module("app").service("invoiceSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getSpecificInvoice=function(d,f,g){var h=b.defer();return a.get("/secure-api/invoice/get_invoice?"+d,f).then(function(a){e=a.data.data;for(var b in e){for(var c in e[b])"string"==typeof e[b][c]&&(e[b][c]=undoCleanEntry(e[b][c])),isNumber(e[b][c])&&(e[b][c]=parseFloat(e[b][c]));e[b].process_date=date_parse(e[b].process_date),e[b].ship_date=date_parse(e[b].ship_date),e[b].delivery_date=date_parse(e[b].delivery_date)}h.resolve(e)}).catch(function(a){h.reject(a),c.go("login")}),h.promise}}])}(window,window.angular),function(a,b,c){b.module("app").service("iotSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getIOT=function(d,f){var g=b.defer();return a.get("/secure-api/iot/get_iot",d).then(function(a){e=a.data.data;for(var b in e)e[b].delivery_type=cleanEntry(e[b].delivery_type);g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.sumbitIOT=function(d,e,f){var g=b.defer();a.post("/secure-api/iot/insert_IOT",d,e).then(function(a){console.log("IOT Submitted"),c.reload()}).catch(function(a){g.reject(a)})},d.updateIOT=function(c,d,e){var f=b.defer();a.put("/secure-api/iot/update_iot",c,d).then(function(a){console.log("IOT Updated")}).catch(function(a){f.reject(a)})},d.deleteIOT=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("IOT Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})}}])}(window,window.angular),function(a,b,c){b.module("app").service("operationAreaSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getOperationalArea=function(d,f){var g=b.defer();return a.get("/secure-api/operational_area/get_operational_area",d).then(function(a){e=a.data.data;for(var b=0;b<e.length;b++)e[b].absolute_minimum_charge=parseFloat(e[b].absolute_minimum_charge),e[b].accelerated_charge&&(e[b].accelerated_charge=parseFloat(e[b].accelerated_charge)),e[b].zip_code&&(e[b].zip_code=undoCleanEntry(e[b].zip_code)),e[b].region=undoCleanEntry(e[b].region),e[b].carrier_name=undoCleanEntry(e[b].carrier_name);g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.sumbitOperationalArea=function(d,e,f){var g=b.defer();a.post("/secure-api/operational_area/insert_operational_area",d,e).then(function(a){console.log("Operational Area Submitted"),c.reload()}).catch(function(a){g.reject(a)})},d.updateOperationalArea=function(c,d,e){var f=b.defer();a.put("/secure-api/operational_area/update_operational_area",c,d).then(function(a){console.log("Operational Area Updated")}).catch(function(a){f.reject(a)})},d.updateMass=function(c,d,e){var f=b.defer();a.put("/secure-api/operational_area/update_operational_region",c,d).then(function(a){console.log("Operational Area Updated")}).catch(function(a){f.reject(a)})},d.deleteOperationalArea=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("Operational Area Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})}}])}(window,window.angular),function(a,b,c){b.module("app").service("regionSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getRegion=function(d,f){var g=b.defer();return a.get("/secure-api/region/get_region",d).then(function(a){e=a.data.data;for(var b in e)e[b].region=undoCleanEntry(e[b].region);g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.sumbitRegion=function(d,e,f){var g=b.defer();a.post("/secure-api/region/insert_region",d,e).then(function(a){console.log("Region Submitted"),c.reload()}).catch(function(a){g.reject(a)})},d.updateRegion=function(c,d,e){var f=b.defer();a.put("/secure-api/region/update_region",c,d).then(function(a){console.log("Region Updated")}).catch(function(a){f.reject(a)})},d.deleteRegion=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("Region Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})}}])}(window,window.angular),function(a,b,c){b.module("app").service("statesSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[];d.getStates=function(d,f){var g=b.defer();return a.get("/secure-api/states/get_state",d).then(function(a){e=a.data.data,g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.sumbitStates=function(d,e,f){var g=b.defer();a.post("/secure-api/states/insert_state",d,e).then(function(a){console.log("State Submitted"),c.reload()}).catch(function(a){g.reject(a)})},d.updateStates=function(c,d,e){var f=b.defer();a.put("/secure-api/states/update_state",c,d).then(function(a){console.log("State Updated")}).catch(function(a){f.reject(a)})},d.deleteStates=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("State Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})}}])}(window,window.angular),function(a,b,c){b.module("app").service("userSvc",["$http","$q","$state",function(a,b,c){var d=this,e=[],f=[];d.getUsers=function(d,f){var g=b.defer();return a.get("/secure-api/user/get_users",d).then(function(a){e=a.data.data,g.resolve(e)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.getUnapprovedUsers=function(d,e){var g=b.defer();return a.get("/secure-api/user/get_unapproved_users",d).then(function(a){f=a.data.data,g.resolve(f)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.getProfile=function(d,e,f){var g=b.defer();return a.get("/secure-api/user/get_user?"+d,e).then(function(a){user=a.data.data[0],g.resolve(user)}).catch(function(a){g.reject(a),c.go("login")}),g.promise},d.passwordRequest=function(c,d){b.defer();a.post("api/user/password_request",c).then(function(a){console.log("Request Submitted")}).catch(function(a){console.log("Request Submitted")})},d.approveUser=function(d,e,f){var g=b.defer();a.post("/secure-api/user/approve_user",d,e).then(function(a){console.log("User Approved"),c.reload()}).catch(function(a){g.reject(a)})},d.submitUser=function(d,e,f){var g=b.defer();a.put("/secure-api/user/update_user",d,e).then(function(a){console.log("User Updated"),c.reload()}).catch(function(a){g.reject(a)})},d.updateProfile=function(d,e,f){var g=b.defer();a.put("/secure-api/user/update_profile",d,e).then(function(a){console.log("User Updated"),c.reload()}).catch(function(a){g.reject(a)})},d.updatePassword=function(d,e,f){var g=b.defer();a.put("/secure-api/user/change_password",d,e).then(function(a){console.log("User Updated"),c.reload()}).catch(function(a){g.reject(a)})},d.deleteUser=function(c,d,e){var f=b.defer();a.delete(c,d).then(function(a){console.log("User Removed"),f.resolve(a)}).catch(function(a){f.reject(a)})},d.token=void 0,d.user=void 0,d.role=void 0;var g,h=localStorage.getItem("token"),i=localStorage.getItem("user");'"Admin"'!==localStorage.getItem("role")&&'"Editor"'!==localStorage.getItem("role")||(g=localStorage.getItem("role")),h&&(d.token=JSON.parse(h),d.user=JSON.parse(i),'"Admin"'!==g&&'"Editor"'!==g||(d.role=JSON.parse(g))),date_parse=function(a){return a=a.toString(),a=moment.utc(a).add("12","hours").format(),a=moment.utc(a).toDate()},padding_right=function(a,b,c){if(!a||!b||a.length>=c)return a;for(var d=(c-a.length)/b.length,e=0;e<d;e++)a+=b;return a},padding_left=function(a,b,c){if(!a||!b||a.length>=c)return a;for(var d=(c-a.length)/b.length,e=0;e<d;e++)a=b+a;return a},isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},cleanEntry=function(a){
return a.replace(/~/g,"&tilde;").replace(/`/g,"&grave;").replace(/!/g,"&excl;").replace(/@/g,"&commat;").replace(/#/g,"&num;").replace(/\$/g,"&dollar;").replace(/%/g,"&percnt;").replace(/\^/g,"&Hat;").replace(/\*/g,"&ast;").replace(/\(/g,"&lpar;").replace(/\)/g,"&rpar;").replace(/-/g,"&hyphen;").replace(/_/g,"&lowbar;").replace(/\+/g,"&plus;").replace(/=/g,"&equals;").replace(/{/g,"&lbrace;").replace(/}/g,"&rbrace;").replace(/]/g,"&rbrack;").replace(/\[/g,"&lbrack;").replace(/:/g,"&colon;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/,/g,"&comma;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\?/g,"&quest;").replace(/\//g,"&sol;").replace(/\|/g,"&vert;")},undoCleanEntry=function(a){return a.replace(/&tilde;/g,"~").replace(/&grave;/g,"`").replace(/&excl;/g,"!").replace(/&commat;/g,"@").replace(/&num;/g,"#").replace(/&dollar;/g,"$").replace(/&percnt;/g,"%").replace(/&Hat;/g,"^").replace(/&ast;/g,"*").replace(/&lpar;/g,"(").replace(/&rpar;/g,")").replace(/&hyphen;/g,"-").replace(/&lowbar;/g,"_").replace(/&plus;/g,"+").replace(/&equals;/g,"=").replace(/&lbrace;/g,"{").replace(/&rbrace;/g,"}").replace(/&rbrack;/g,"]").replace(/&lbrack;/g,"[").replace(/&colon;/g,":").replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&comma;/g,",").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quest;/g,"?").replace(/&sol;/g,"/").replace(/&vert;/g,"|")},sanatizePercent=function(a){var b=String(a);return-1==b.indexOf(".")?b>=1&&b<100?b/=100:b="."+b:b>1&&b<10?b/=100:b<1?(b=b.replace(".",""),b="."+b,b*=10):(b=b.replace(".",""),b="."+b),b=parseFloat(b),Math.round(1e4*b)/1e4}}]).filter("dateRange",function(){return function(a,b,c,d){return a.filter(function(a){return!moment(a[b],"YYYY-MM-DD").isBefore(moment(c))&&!moment(a[b],"YYYY-MM-DD").isAfter(moment(d))})}})}(window,window.angular),function(a,b,c){b.module("app").controller("loginCtrl",["$scope","$state","userSvc","$http",function(b,c,d,e){b.logUserIn=function(a){e.post("/api/user/login",a).then(function(a){d.token=a.data.token,d.user=a.data.user.username,localStorage.setItem("token",JSON.stringify(d.token)),localStorage.setItem("user",JSON.stringify(d.user)),"Admin"!==a.data.user.role&&"Editor"!==a.data.user.role||(d.role=a.data.user.role,localStorage.setItem("role",JSON.stringify(d.role))),c.go("home")},function(a){if(console.error(a),Array.isArray(a.data)){$("#password_Error").empty(),$("#login_error").empty();for(var b=0;b<a.data.length;b++)$("#login_error").append('<p class="alert alert-danger">'+a.data[b]+"<p>")}else $("#password_Error").empty(),$("#login_error").empty(),$("#login_error").append('<p class="alert alert-danger">'+a.data+"<p>")})},b.passwordRecovery=function(){c.go("password_recovery")},b.sent=!1,b.forgotPassword=function(c){b.email=c.email,config={hello:"hi"},c={to:c.email,urlBase:a.location.origin},b.sent=!0,d.passwordRequest(c)}}])}(window,window.angular),function(a,b,c){b.module("app").controller("manageUserCtrl",["$scope","$state","$http","userSvc",function(a,b,c,d){var e={headers:{"auth-token":d.token}};a.roles=["User","Editor","Admin"],a.allUsers=[],a.allUnapprovedUsers=[],a.getEverything=function(b){d.getUsers(b).then(function(b){a.allUsers=b}),d.getUnapprovedUsers(b).then(function(b){a.allUnapprovedUsers=b})},a.getEverything(e),a.approveUser=function(a){a.login_attempts=0,a.last_login_attempt=Date.now(),console.log(a),d.approveUser(a,e)},a.submitUser=function(a){d.submitUser(a,e)},a.deleteUnapprovedUser=function(b){if(confirm("Are you sure you want to deny this User?")){request="/secure-api/user/delete_unapproved_user/?"+b,d.deleteUser(request,e);for(var c in a.allUnapprovedUsers)a.allUnapprovedUsers[c].unapproved_user_id===b&&a.allUnapprovedUsers.splice(c,1)}},a.deleteUser=function(b){if(confirm("Are you sure you want to delete this User?")&&b.username!=d.user){request="/secure-api/user/delete_user/?"+b.id,d.deleteUser(request,e);for(var c in a.allUsers)a.allUsers[c].id===b.id&&a.allUsers.splice(c,1)}else console.log("You cant delete yourself from this screen.")}}])}(window,window.angular),function(a,b,c){b.module("app").controller("profileCtrl",["$scope","$state","userSvc",function(a,b,c){var d={headers:{"auth-token":c.token}};a.user={},a.passLength=!1,a.special=!1,a.upperCase=!1,a.lowerCase=!1,a.number=!1,a.requirements=!1,a.passMatch=!1,a.errors=!1,a.errorsArry=[],a.getProfile=function(b,d){c.getProfile(b,d).then(function(b){a.user=b,a.user_id=a.user.id})},a.getProfile(c.user,d),a.submitProfile=function(a){c.updateProfile(a,d)},a.deleteProfile=function(b){confirm("Are you sure you want to delete your account? This CANNOT be undone.")&&a.user_id===b&&(request="/secure-api/user/delete_profile/?"+b,c.deleteUser(request,d),a.logout())},a.passCheck=function(b,c){var d=/[~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/,e=/[A-Z]/,f=/[a-z]/,g=/\d/;b.length>13?a.passLength=!0:b.length<14&&(a.passLength=!1),d.test(b)?a.special=!0:a.special=!1,e.test(b)?a.upperCase=!0:a.upperCase=!1,f.test(b)?a.lowerCase=!0:a.lowerCase=!1,g.test(b)?a.number=!0:a.number=!1,a.passMatch=b===c,!0===a.passMatch&&!0===a.passLength&&!0===a.special&&!0===a.upperCase&&!0===a.lowerCase&&!0===a.number?a.requirements=!0:a.requirements=!1},a.changePassword=function(b){!0===a.requirements?c.updatePassword(b,d):(console.log("Passwords Requirments Not Met"),a.errors=!0,a.errorsArry=[],a.errorsArry.push("Passwords Requirments Not Met"))}}])}(window,window.angular),function(a,b,c){b.module("app").controller("registerCtrl",["$scope","$state","$http","userSvc",function(a,b,c,d){a.passLength=!1,a.special=!1,a.upperCase=!1,a.lowerCase=!1,a.number=!1,a.requirements=!1,a.passMatch=!1,a.formChange=function(b){var c=/[~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/,d=/[A-Z]/,e=/[a-z]/,f=/\d/;b.user_password.length>13?a.passLength=!0:b.user_password.length<14&&(a.passLength=!1),c.test(b.user_password)?a.special=!0:a.special=!1,d.test(b.user_password)?a.upperCase=!0:a.upperCase=!1,e.test(b.user_password)?a.lowerCase=!0:a.lowerCase=!1,f.test(b.user_password)?a.number=!0:a.number=!1,b.user_password===b.password_check?a.passMatch=!0:a.passMatch=!1,!0===a.passMatch&&!0===a.passLength&&!0===a.special&&!0===a.upperCase&&!0===a.lowerCase&&!0===a.number?a.requirements=!0:a.requirements=!1},a.createUser=function(d){!0===a.requirements?($("#password_Error").empty(),$("#login_error").empty(),d.user_password===d.password_check?c.post("/api/user/create",d).then(function(a){$("#password_Error").empty(),$("#login_error").empty(),b.go("home")},function(a){if(console.error(a),Array.isArray(a.data)){$("#password_Error").empty(),$("#login_error").empty();for(var b=0;b<a.data.length;b++)$("#password_Error").append('<p class="alert alert-danger">'+a.data[b]+"<p>")}else $("#password_Error").empty(),$("#login_error").empty(),$("#password_Error").append('<p class="alert alert-danger">'+a.data+"<p>")}):($("#password_Error").empty(),$("#password_Error").append('<p class="alert alert-danger"> Passwords do not match, please make sure that they are the same <p>'))):($("#password_Error").empty(),$("#password_Error").append('<p class="alert alert-danger"> Please make sure you\'re password meets the requirements<p>'))}}])}(window,window.angular),function(a,b,c){b.module("app").controller("pswdCtrl",["$scope","$state","$http","$stateParams","userSvc",function(a,b,c,d,e){a.state=b.current,a.params=d,a.resetCode=a.params.resetCode,a.user_id=a.params.userID,a.passLength=!1,a.special=!1,a.upperCase=!1,a.lowerCase=!1,a.number=!1,a.requirements=!1,a.passMatch=!1,a.formChange=function(b){var c=/[~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/,d=/[A-Z]/,e=/[a-z]/,f=/\d/;b.enter.length>13?a.passLength=!0:b.enter.length<14&&(a.passLength=!1),c.test(b.enter)?a.special=!0:a.special=!1,d.test(b.enter)?a.upperCase=!0:a.upperCase=!1,e.test(b.enter)?a.lowerCase=!0:a.lowerCase=!1,f.test(b.enter)?a.number=!0:a.number=!1,b.enter===b.check?a.passMatch=!0:a.passMatch=!1,!0===a.passMatch&&!0===a.passLength&&!0===a.special&&!0===a.upperCase&&!0===a.lowerCase&&!0===a.number?a.requirements=!0:a.requirements=!1},a.submitPassword=function(d){!0===a.requirements?($("#message").empty(),void 0===d.check||void 0===d.enter?$("#message").append('<br><p class="alert alert-danger"> Please enter a password. </p>'):d.check!=d.enter?$("#message").append('<br><p class="alert alert-danger"> The entered passwords do not match. </p>'):d.check===d.enter&&(d.reset_code=a.resetCode,d.user_id=a.user_id,c.post("api/user/reset_password",d),b.go("login"))):$("#password_Error").append('<p class="alert alert-danger"> Please make sure you\'re password meets the requirements<p>')}}])}(window,window.angular);
>>>>>>> master
